webpackJsonp([1],{"1/oy":function(t,e){},"1s1a":function(t,e){},"2BCl":function(t,e){},"2w18":function(t,e){},"8qVb":function(t,e){},"9M+g":function(t,e){},BSPH:function(t,e){},GfHa:function(t,e){},Gv4G:function(t,e){},Id91:function(t,e){},Jmt5:function(t,e){},NHnr:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("7+uW"),r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var n=o("VU/8")({name:"App"},r,!1,function(t){o("o8nZ")},null,null).exports,i=o("/ocq"),s=o("Dd8w"),c=o.n(s),l={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("b-navbar",{attrs:{toggleable:"md",type:"dark",variant:"info"}},[o("b-navbar-toggle",{attrs:{target:"nav_collapse"}}),t._v(" "),o("b-navbar-brand",{attrs:{href:"#"}},[t._v("NavBar")]),t._v(" "),o("b-collapse",{attrs:{"is-nav":"",id:"nav_collapse"}},[o("b-navbar-nav",[o("b-nav-item",{attrs:{href:"#"}},[t._v("Inicio")]),t._v(" "),o("b-nav-item",{attrs:{href:"#",disabled:""}},[t._v("Disabled")]),t._v(" "),o("b-nav-item-dropdown",{attrs:{text:"Lang",right:""}},[o("b-dropdown-item",{attrs:{href:"#"}},[t._v("EN")]),t._v(" "),o("b-dropdown-item",{attrs:{href:"#"}},[t._v("ES")]),t._v(" "),o("b-dropdown-item",{attrs:{href:"#"}},[t._v("RU")]),t._v(" "),o("b-dropdown-item",{attrs:{href:"#"}},[t._v("FA")])],1)],1),t._v(" "),o("b-navbar-nav",{staticClass:"ml-auto"},[o("b-nav-item-dropdown",{attrs:{right:""}},[o("template",{slot:"button-content"},[o("em",[t._v("User")])]),t._v(" "),o("b-dropdown-item",{attrs:{href:"#"}},[t._v("Profile")]),t._v(" "),o("b-dropdown-item",{attrs:{href:"#"}},[t._v("Signout")])],2)],1)],1)],1)},staticRenderFns:[]};var u=o("VU/8")({},l,!1,function(t){o("2w18")},null,null).exports,d=o("NYxO"),p=o("UdTa"),v=o.n(p),m=o("bOdI"),h=o.n(m),f={data:function(){return h()({API:v.a.API,show:!1,categoria:{}},"show",!1)},props:["showButton","cbGuardar"],methods:{guardarCategoria:function(){var t=this;this.categoria.ProductoCategoria&&(this.categoria.ProductoCategoria=this.categoria.ProductoCategoria.toUpperCase(),this.axios.post(this.API+"categorias",this.categoria).then(function(e){t.$toasted.show("Categoría guardada correctamente"),t.cbGuardar&&t.cbGuardar({IdProductoCategoria:e.data.insertId,ProductoCategoria:e.data.ProductoCategoria}),t.categoria.ProductoCategoria=""}).catch(function(e){console.log(e),t.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")}))}}},b={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.showButton?o("b-btn",{attrs:{id:"popoverCategoriaForm",variant:"primary"}},[o("b",[t._v("+")])]):t._e(),t._v(" "),o("b-popover",{ref:"popover",attrs:{target:"popoverCategoriaForm",triggers:"focus",title:"Nueva Categoría"}},[o("b-form-group",[o("label",[t._v("Categoria:")]),t._v(" "),o("b-form-input",{staticClass:"upper",attrs:{type:"text",value:""},nativeOn:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.guardarCategoria(e):null}},model:{value:t.categoria.ProductoCategoria,callback:function(e){t.$set(t.categoria,"ProductoCategoria",e)},expression:"categoria.ProductoCategoria"}})],1),t._v(" "),o("b-btn",{attrs:{size:"sm",variant:"success"},on:{click:t.guardarCategoria}},[t._v("Guardar")])],1)],1)},staticRenderFns:[]};var _={data:function(){return h()({API:v.a.API,show:!1,marca:{}},"show",!1)},props:["showButton","cbGuardar"],methods:{guardarMarca:function(){var t=this;this.marca.ProductoMarca&&(this.marca.ProductoMarca=this.marca.ProductoMarca.toUpperCase(),this.axios.post(this.API+"marcas",this.marca).then(function(e){t.$toasted.show("Marca guardada correctamente"),t.cbGuardar&&t.cbGuardar({IdProductoMarca:e.data.insertId,ProductoMarca:e.data.ProductoMarca}),t.marca.ProductoMarca=""}).catch(function(e){console.log(e),t.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")}))}}},g={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.showButton?o("b-btn",{attrs:{id:"popoverMarcaForm",variant:"primary"}},[o("b",[t._v("+")])]):t._e(),t._v(" "),o("b-popover",{ref:"popover",attrs:{target:"popoverMarcaForm",triggers:"focus",title:"Nueva Marca"}},[o("b-form-group",[o("label",[t._v("Marca:")]),t._v(" "),o("b-form-input",{staticClass:"upper",attrs:{type:"text",value:""},nativeOn:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.guardarMarca(e):null}},model:{value:t.marca.ProductoMarca,callback:function(e){t.$set(t.marca,"ProductoMarca",e)},expression:"marca.ProductoMarca"}})],1),t._v(" "),o("b-btn",{attrs:{size:"sm",variant:"success"},on:{click:t.guardarMarca}},[t._v("Guardar")])],1)],1)},staticRenderFns:[]};var P={mounted:function(){this.getProductosDet()},data:function(){return{show:!1,API:v.a.API,productos:[]}},props:["idProducto"],methods:{emitUpdate:function(){this.$emit("onUpdateProductos",this.productos)},getProductosDet:function(){var t=this;this.idProducto&&this.axios.get(this.API+"productosdet",{params:{idProducto:this.idProducto}}).then(function(e){t.productos=e.data}).catch(function(t){console.log(t)})},renderChild:function(t){return"\n        <b>"+t.IdProducto+" - "+t.Producto+" - "+t.CodigoBarra+"</b>\n      "},addProducto:function(t){var e=this;this.productos.findIndex(function(e){return e.IdProductoDet==t.IdProducto})>=0?this.$toasted.show("El producto ya está agregado"):this.idProducto!=t.IdProducto?this.axios.get(this.API+"productos/espadre",{params:{idProducto:t.IdProducto}}).then(function(o){o.data.esPadre?e.$toasted.show("No puede agregar un producto padre"):(t.IdProductoDet=t.IdProducto,e.productos.push(t),e.emitUpdate())}):this.$toasted.show("No puede agregar el mismo producto que esta editando")},quitarProducto:function(t){var e=this.productos.findIndex(function(e){return e.IdProductoDet==t.IdProductoDet});this.productos.splice(e,1),this.emitUpdate()},focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()}}},C={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.show?o("div",[o("b-form-group",[o("label",[t._v("Agrega Subproductos:")]),t._v(" "),o("b-input-group",[o("autocomplete",{ref:"inputProducto",attrs:{url:t.API+"productos",anchor:"Producto",onShouldRenderChild:t.renderChild,label:"writer",placeholder:"Seleccionar Producto","on-select":t.addProducto,onFocus:t.focusAutocomplete.bind(null,"inputProducto"),classes:{input:"form-control upper"}}})],1)],1),t._v(" "),o("table",{staticClass:"table b-table table-sm"},[t._m(0),t._v(" "),o("tbody",t._l(t.productos,function(e,a){return o("tr",{key:a},[o("td",[t._v(t._s(e.IdProductoDet))]),t._v(" "),o("td",[t._v(t._s(e.Producto))]),t._v(" "),o("td",[o("input",{directives:[{name:"model",rawName:"v-model",value:e.Cantidad,expression:"prod.Cantidad"}],staticClass:"form-control",attrs:{type:"number",requiredv:""},domProps:{value:e.Cantidad},on:{input:[function(o){o.target.composing||t.$set(e,"Cantidad",o.target.value)},t.emitUpdate]}})]),t._v(" "),o("td",{staticClass:"text-center"},[o("b-button",{attrs:{variant:"danger",size:"sm"},on:{click:function(o){t.quitarProducto(e)}}},[t._v("X")])],1)])}))])],1):t._e()},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",[this._v("Id")]),this._v(" "),e("th",[this._v("Producto")]),this._v(" "),e("th",[this._v("Cantidad")]),this._v(" "),e("th",{staticClass:"text-center"},[this._v("Quitar")])])])}]};var I={data:function(){return{showProductoDet:!0,cantidadCodigoBarra:1,title:"Nuevo Producto",API:v.a.API,show:!1,producto:{},productosDet:[]}},beforeMount:function(){this.initForm()},props:["showButton","productoUpdate","cbGuardar"],watch:{show:function(t){var e=this,o=this.productoUpdate||{};o.IdProducto?(this.title="Editar Producto << "+o.CodigoBarra+" >>",this.producto.categoria={IdProductoCategoria:o.IdProductoCategoria,ProductoCategoria:o.ProductoCategoria},this.producto.marca={IdProductoMarca:o.IdProductoMarca,ProductoMarca:o.ProductoMarca},this.producto.medicion={IdProductoMedicion:o.IdProductoMedicion,ProductoMedicion:o.ProductoMedicion},this.$refs.inputCategoria.setValue(o.ProductoCategoria),this.$refs.inputMarca.setValue(o.ProductoMarca),this.$refs.inputMedicion.setValue(o.ProductoMedicion),this.$refs.inputPresentacion.setValue(o.ProductoPresentacion),this.$refs.inputCodigoBarra.$el.disabled=!0,this.producto.Producto=o.Producto,this.producto.IdProducto=o.IdProducto,this.producto.EsPadre=o.EsPadre,Vue.nextTick(function(){e.$refs.productoDet&&(e.$refs.productoDet.show=parseInt(o.EsPadre))}),this.producto.PorcentajeUtilidad=o.PorcentajeUtilidad,this.producto.StockMinimo=o.StockMinimo,this.producto.CodigoBarra=o.CodigoBarra,this.producto.ProductoPresentacion=o.ProductoPresentacion,this.producto.PrecioCosto=o.PrecioCosto,this.producto.PrecioContado=o.PrecioContado,this.producto.EsHabitacion=o.EsHabitacion,this.producto.Piso=o.Piso,this.producto.ControlaStock=o.ControlaStock,console.log(o)):(this.title="Nuevo Producto",this.clearForm(),this.$refs.inputCodigoBarra.$el.disabled=!1)}},methods:{calcularPreciosPaquete:function(t){var e=0,o=0;t.forEach(function(t){t.Cantidad&&(e+=t.PrecioCosto*t.Cantidad,o+=t.PrecioContado*t.Cantidad)}),e=this.$options.filters.redondear(e),o=this.$options.filters.redondear(o),Vue.set(this.producto,"PrecioCosto",e),Vue.set(this.producto,"PrecioContado",o),this.actualizarPorcentajeUtilidad()},eliminarProducto:function(t){var e=this;confirm("¿Esta seguro de Anular este producto?")&&this.axios.post(this.API+"productos/delete",{id:t.IdProducto}).then(function(t){t.data.updated&&(e.$toasted.success("El producto con código "+t.data.IdProducto+" ha sido anulado"),e.cbGuardar&&e.cbGuardar(),e.$refs.productoForm.hide())})},actualizarPrecioContado:function(){var t=this.producto.PrecioCosto/(1-this.producto.PorcentajeUtilidad/100);this.producto.precioContadoNormal=t,this.producto.PrecioContado=this.$options.filters.redondear(t,1)},actualizarPorcentajeUtilidad:function(){var t=this.producto.PrecioContado,e=this.producto.PrecioCosto;this.producto.PorcentajeUtilidad=this.$options.filters.redondear(100*(1-e/t))},setCategoria:function(t){this.producto.categoria=t,this.$refs.inputCategoria.setValue(t.ProductoCategoria)},setMedicion:function(t){this.producto.medicion=t},setMarca:function(t){this.producto.marca=t,this.$refs.inputMarca.setValue(t.ProductoMarca)},clearForm:function(){this.$refs.inputCategoria.setValue(""),this.$refs.inputMarca.setValue(""),this.$refs.inputMedicion.setValue("UNIDAD"),this.$refs.inputPresentacion.setValue(""),this.initForm()},initForm:function(){this.producto={EsPadre:0,Anulado:0,EsHabitacion:0,Piso:1,IdProductoMarca:null,IdProductoMedicion:null,IdProductoCategoria:null,Producto:"",CodigoBarra:"",PorcentajeUtilidad:"",StockMinimo:0,PrecioContado:"",categoria:{},marca:{},medicion:{IdProductoMedicion:6,ProductoMedicion:"UNIDAD"}}},guardarProducto:function(t){var e=this;t.preventDefault(),this.showProductoDet&&(this.producto.productosDet=this.$refs.productoDet.productos),this.axios.post(this.API+"productos",this.producto).then(function(t){e.cbGuardar&&e.cbGuardar(t.data.insertId),t.data.error?e.$toasted.show(t.data.error+" - "+t.data.codigoBarra):(e.$toasted.show("Producto guardado correctamente"),e.$refs.productoForm.hide())}).catch(function(t){console.log(t),e.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})},focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()},crearCategoria:function(){var t=this;if(this.$refs.inputCategoria.type){var e={};e.ProductoCategoria=this.$refs.inputCategoria.type.toUpperCase(),this.axios.post(this.API+"categorias",e).then(function(e){t.$toasted.show("Categoría guardada correctamente"),t.setCategoria({IdProductoCategoria:e.data.insertId,ProductoCategoria:e.data.ProductoCategoria})}).catch(function(e){console.log(e),t.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})}},crearMarca:function(){var t=this;if(this.$refs.inputMarca.type){var e={};e.ProductoMarca=this.$refs.inputMarca.type.toUpperCase(),this.axios.post(this.API+"marcas",e).then(function(e){t.$toasted.show("Marca guardada correctamente"),t.setMarca({IdProductoMarca:e.data.insertId,ProductoMarca:e.data.ProductoMarca})}).catch(function(e){console.log(e),t.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})}},crearTalla:function(){var t=this;if(this.$refs.inputTalla.type){var e={};e.ProductoTalla=this.$refs.inputTalla.type.toUpperCase(),this.axios.post(this.API+"tallas",e).then(function(e){t.$toasted.show("Talla guardada correctamente"),t.setTalla({IdProductoTalla:e.data.insertId,ProductoTalla:e.data.ProductoTalla})}).catch(function(e){console.log(e),t.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})}},checkIsHijo:function(t){var e=this;t&&this.producto.IdProducto?this.axios.get(this.API+"productos/eshijo",{params:{idProducto:this.producto.IdProducto}}).then(function(t){t.data.esHijo?(e.$toasted.show("Este producto no puede contener productos ya que es un producto hijo"),e.producto.EsPadre=!1):e.$refs.productoDet.show=parseInt(e.producto.EsPadre)}):this.$refs.productoDet&&(this.$refs.productoDet.show=parseInt(this.producto.EsPadre))}},computed:{},components:{CategoriaForm:o("VU/8")(f,b,!1,function(t){o("XZXq")},null,null).exports,MarcaForm:o("VU/8")(_,g,!1,function(t){o("Gv4G")},null,null).exports,ProductoFormDet:o("VU/8")(P,C,!1,function(t){o("Sxdx")},null,null).exports}},k={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.showButton?o("b-btn",{directives:[{name:"b-modal",rawName:"v-b-modal.modalProducto",modifiers:{modalProducto:!0}}],attrs:{variant:"primary"}},[t._v("Nuevo")]):t._e(),t._v(" "),o("b-form",{on:{submit:t.guardarProducto,keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}}},[o("b-modal",{ref:"productoForm",attrs:{"no-close-on-esc":!0,id:"modalProducto",title:t.title,size:"lg"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("b-row",[o("b-col",{attrs:{md:"6"}},[o("b-form-group",[o("label",[t._v("Código barra:")]),t._v(" "),o("b-form-input",{ref:"inputCodigoBarra",staticClass:"form-control upper",attrs:{required:"required",type:"text"},on:{input:function(e){return t.producto.CodigoBarra=e&&e.toUpperCase()}},model:{value:t.producto.CodigoBarra,callback:function(e){t.$set(t.producto,"CodigoBarra",e)},expression:"producto.CodigoBarra"}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Categoría:")]),t._v(" "),o("b-input-group",[o("autocomplete",{ref:"inputCategoria",attrs:{required:"required",url:t.API+"categorias",anchor:"ProductoCategoria",label:"writer",placeholder:t.producto.categoria.ProductoCategoria,"on-select":t.setCategoria,onFocus:t.focusAutocomplete.bind(null,"inputCategoria"),classes:{input:"form-control upper"}}}),t._v(" "),o("b-input-group-append",[o("b-btn",{attrs:{variant:"primary"},on:{click:t.crearCategoria}},[o("b",[t._v("Guardar")])])],1)],1)],1),t._v(" "),o("b-form-group",[o("label",[t._v("Marca:")]),t._v(" "),o("b-input-group",[o("autocomplete",{ref:"inputMarca",attrs:{required:"required",url:t.API+"marcas",anchor:"ProductoMarca",label:"writer",placeholder:t.producto.marca.ProductoMarca,"on-select":t.setMarca,onFocus:t.focusAutocomplete.bind(null,"inputMarca"),classes:{input:"form-control upper"}},on:{"update:placeholder":function(e){t.$set(t.producto.marca,"ProductoMarca",e)}}}),t._v(" "),o("b-input-group-append",[o("b-btn",{attrs:{variant:"primary"},on:{click:t.crearMarca}},[o("b",[t._v("Guardar")])])],1)],1)],1),t._v(" "),o("b-form-group",[o("label",[t._v("Artículo:")]),t._v(" "),o("b-form-input",{ref:"inputProducto",attrs:{required:"required",type:"text",value:t.producto.Producto},on:{input:function(e){return t.producto.Producto=e&&e.toUpperCase()}},model:{value:t.producto.Producto,callback:function(e){t.$set(t.producto,"Producto",e)},expression:"producto.Producto"}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Presentación:")]),t._v(" "),o("autocomplete",{ref:"inputPresentacion",attrs:{url:t.API+"productos/presentaciones",anchor:"ProductoPresentacion",label:"writer",placeholder:t.producto.ProductoPresentacion,"on-select":function(e){return t.producto.ProductoPresentacion=e.ProductoPresentacion&&e.ProductoPresentacion.toUpperCase()},onInput:function(e){return t.producto.ProductoPresentacion=e&&e.toUpperCase()},onFocus:t.focusAutocomplete.bind(null,"inputPresentacion"),classes:{input:"form-control upper"}},on:{"update:placeholder":function(e){t.$set(t.producto,"ProductoPresentacion",e)}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"6"}},[o("b-form-group",[o("label",[t._v("Medición:")]),t._v(" "),o("autocomplete",{ref:"inputMedicion",attrs:{required:"required",url:t.API+"mediciones",initValue:"UNIDAD",anchor:"ProductoMedicion",label:"writer",placeholder:t.producto.medicion.ProductoMedicion,"on-select":t.setMedicion,onFocus:t.focusAutocomplete.bind(null,"inputMedicion"),classes:{input:"form-control"}},on:{"update:placeholder":function(e){t.$set(t.producto.medicion,"ProductoMedicion",e)}}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Porcentaje Utilidad:")]),t._v(" "),o("b-form-input",{attrs:{required:"required",type:"number",min:"0",step:"0.0001"},nativeOn:{input:function(e){return t.actualizarPrecioContado(e)}},model:{value:t.producto.PorcentajeUtilidad,callback:function(e){t.$set(t.producto,"PorcentajeUtilidad",e)},expression:"producto.PorcentajeUtilidad"}})],1),t._v(" "),t.producto.EsPadre?t._e():o("b-form-group",[o("label",[t._v("Stock Minimo:")]),t._v(" "),o("b-form-input",{attrs:{required:"required",type:"number"},model:{value:t.producto.StockMinimo,callback:function(e){t.$set(t.producto,"StockMinimo",e)},expression:"producto.StockMinimo"}})],1),t._v(" "),o("b-form-group",[o("b-form-checkbox",{attrs:{value:1,"unchecked-value":0},model:{value:t.producto.ControlaStock,callback:function(e){t.$set(t.producto,"ControlaStock",e)},expression:"producto.ControlaStock"}},[t._v("\n            Controla Stock\n          ")])],1),t._v(" "),o("b-form-group",[o("label",[t._v("Activar SubProductos:")]),t._v(" "),o("b-form-checkbox",{attrs:{value:1,"unchecked-value":0},on:{input:t.checkIsHijo},model:{value:t.producto.EsPadre,callback:function(e){t.$set(t.producto,"EsPadre",e)},expression:"producto.EsPadre"}},[t._v("\n            Seleccione esta opción si el producto contiene mas productos\n          ")])],1),t._v(" "),o("b-form-group",[o("label",[t._v("Activar Habitación:")]),t._v(" "),o("b-form-checkbox",{attrs:{value:1,"unchecked-value":0},model:{value:t.producto.EsHabitacion,callback:function(e){t.$set(t.producto,"EsHabitacion",e)},expression:"producto.EsHabitacion"}},[t._v("\n            Seleccione esta opción si es una habitación\n          ")])],1),t._v(" "),t.producto.EsHabitacion?o("b-form-group",[o("label",[t._v("Piso Habitación:")]),t._v(" "),o("b-form-select",{staticClass:"mb-3",attrs:{required:"required",options:[1,2,3,4,5,6,7,8,9,10]},model:{value:t.producto.Piso,callback:function(e){t.$set(t.producto,"Piso",e)},expression:"producto.Piso"}})],1):t._e()],1)],1),t._v(" "),t.producto.IdProducto||t.producto.EsPadre?o("hr"):t._e(),t._v(" "),t.producto.IdProducto||t.producto.EsPadre?o("b-row",[o("b-col",{attrs:{md:"6"}},[o("b-form-group",[o("label",[t._v("Precio de Costo:")]),t._v(" "),o("b-form-input",{attrs:{readonly:"readonly",type:"number"},model:{value:t.producto.PrecioCosto,callback:function(e){t.$set(t.producto,"PrecioCosto",e)},expression:"producto.PrecioCosto"}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"6"}},[o("b-form-group",[o("label",[t._v("Precio de Venta:")]),t._v(" "),o("b-form-input",{attrs:{type:"number"},nativeOn:{input:function(e){return t.actualizarPorcentajeUtilidad(e)}},model:{value:t.producto.PrecioContado,callback:function(e){t.$set(t.producto,"PrecioContado",e)},expression:"producto.PrecioContado"}}),t._v(" "),t.producto.precioContadoNormal?o("b-form-text",[t._v("\n              Original - "+t._s(t._f("redondear")(t.producto.precioContadoNormal))+"\n            ")]):t._e()],1)],1)],1):t._e(),t._v(" "),o("hr"),t._v(" "),o("b-row",[o("b-col",[t.showProductoDet&&t.show?o("producto-form-det",{ref:"productoDet",attrs:{"id-producto":t.producto.IdProducto},on:{onUpdateProductos:t.calcularPreciosPaquete}}):t._e()],1)],1),t._v(" "),o("div",{attrs:{slot:"modal-footer"},slot:"modal-footer"},[t.producto.IdProducto?o("div",{staticStyle:{left:"1rem",position:"absolute"}},[o("b-input-group",[o("b-form-input",{staticStyle:{width:"80px"},attrs:{type:"number"},model:{value:t.cantidadCodigoBarra,callback:function(e){t.cantidadCodigoBarra=e},expression:"cantidadCodigoBarra"}}),t._v(" "),o("b-input-group-append",[o("b-btn",{attrs:{variant:"info",target:"_blank",href:"/views/codigoBarra.php?idProducto="+t.producto.IdProducto+"&cantidad="+t.cantidadCodigoBarra}},[t._v("Código de barra")])],1)],1)],1):t._e(),t._v(" "),t.producto.IdProducto?o("b-btn",{attrs:{variant:"danger"},on:{click:function(e){t.eliminarProducto(t.producto)}}},[t._v("\n        Anular\n      ")]):t._e(),t._v(" "),t.producto.IdProducto?t._e():o("b-btn",{attrs:{variant:"warning"},on:{click:t.clearForm}},[t._v("\n        Limpiar\n      ")]),t._v(" "),o("b-btn",{attrs:{variant:"primary",type:"submit"}},[t._v("\n         Guardar\n       ")]),t._v(" "),o("b-btn",{attrs:{variant:"secondary"},on:{click:function(e){t.show=!1}}},[t._v("\n         Close\n       ")])],1)],1)],1)],1)},staticRenderFns:[]};var A=o("VU/8")(I,k,!1,function(t){o("vEAQ")},null,null).exports,x={mounted:function(){},data:function(){return{API:v.a.API,loadCode:"",pasteCode:!1,producto:{},items:[],handleKeyDown:!1,vuelto:0,pagocon:0}},watch:{sumatoriaTotal:function(t){this.asignarVuelto()}},props:{setPrecio:Boolean,igvTotal:Boolean,onSetProducto:{type:Function,default:function(t){return t}},showButton:{default:!0,type:Boolean},fields:{default:function(){return[{key:"CodigoBarra",label:"Código"},{key:"ProductoCategoria",label:"Categoria"},{key:"Producto",label:"Artículo"},{key:"ProductoMarca",label:"Marca"},{key:"ProductoPresentacion",label:"Present."},{key:"ProductoMedicion",label:"Medición"},{key:"cantidad"},{key:"precio",label:"P/U"},{key:"subtotal",label:"SubTotal",variant:"success"},{key:"igv",label:"IGV"},{key:"precioVenta",label:"Precio venta"},{key:"total",label:"Total",variant:"danger"},{key:"acciones",label:""}]},type:Array}},computed:c()({},Object(d.c)({productos:function(t){return t.cart.productos},filtrados:function(t){return t.cart.productosFiltrados}}),{sumatoriaSubTotal:function(){var t=0;return this.igvTotal?t=this.sumatoriaTotal/1.18:this.productos.map(function(e){t+=parseFloat(e.subtotal),e.descuento&&(t-=e.descuento)}),this.$options.filters.redondear(t)},sumatoriaTotal:function(){var t=0;return this.productos.map(function(e){t+=parseFloat(e.total)}),this.actualizarTotal(t),this.$options.filters.redondear(t)},sumatoriaIgv:function(){var t=0;return this.igvTotal?(t=this.sumatoriaTotal,t-=t/1.18):this.productos.map(function(e){t+=parseFloat(e.igv)}),this.$options.filters.redondear(t)},sumatoriaDescuento:function(){var t=0;return this.productos.map(function(e){t+=parseFloat(e.descuento||0)}),this.$options.filters.redondear(t)}}),methods:c()({},Object(d.b)({add:"agregarProducto",buscar:"buscarProductos",eliminar:"eliminarProducto",actualizarTotal:"actualizarTotalCart"}),{asignarVuelto:function(){this.vuelto=this.pagocon-this.sumatoriaTotal},loadBarcode:function(t){var e=this;t.preventDefault();var o=this.loadCode;o&&this.add([o,function(t){t?(e.$emit("onAddProducto"),e.$toasted.show("Producto añadido correctamente")):e.$toasted.show("No se encontró ningun producto"),e.loadCode=""},{setPrecio:this.setPrecio,setSuma:!0},!0])},focusAutocomplete:function(t){this.$refs[t].type="",this.$refs[t].handleDoubleClick()},setProducto:function(t){var e=this;this.$refs.autocompleteProducto.setValue(""),t.precio=0,t.cantidad=0,t.descuento=0,t.nuevoPrecioContado=0,t=this.onSetProducto(t),this.add([t,function(){e.$emit("onAddProducto",t)}])},renderChild:function(t){return"\n        <b>"+t.Producto+" - "+t.CodigoBarra+"</b> / "+t.ProductoCategoria+" / "+t.ProductoMarca+" / "+t.ProductoPresentacion+" / "+t.ProductoMedicion+"\n      "},setNuevoPrecioContado:function(t){var e=parseFloat(this.productos[t].precio);this.productos[t].TieneIgv&&(e+=.18*e),e/=1-this.productos[t].PorcentajeUtilidad/100;var o=this.$options.filters.redondear(e),a=this.$options.filters.redondear(e,1);Vue.set(this.productos[t],"normalPrecioContado",o),Vue.set(this.productos[t],"nuevoPrecioContado",a)},getSubtotal:function(t){var e=this.$options.filters.redondear(this.productos[t].cantidad*this.productos[t].precio);return Vue.set(this.productos[t],"subtotal",e),e},getIgv:function(t){var e=0;return this.productos[t].TieneIgv&&(e=this.$options.filters.redondear(.18*this.productos[t].subtotal)),Vue.set(this.productos[t],"igv",e),e},getTotal:function(t){var e=parseFloat(this.productos[t].subtotal);return this.productos[t].FLETE&&(e+=parseFloat(this.productos[t].FLETE)),this.productos[t].TieneIgv&&(e+=parseFloat(this.productos[t].igv)),this.productos[t].descuento&&(e-=parseFloat(this.productos[t].descuento)),e=this.$options.filters.redondear(e),Vue.set(this.productos[t],"total",e),e},getData:function(t){this.buscar(t)},quitarProducto:function(t){this.eliminar(t),this.$emit("onRemoveProducto",t),this.$toasted.show("Producto quitado del listado")},formatFecha:function(t){return t?this.$moment(t,"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD"):""}}),components:{ProductoForm:A}},w={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("b-row",[o("b-col",{attrs:{md:"12"}},[o("b-form-group",[o("label",[t._v("Agregar Productos:")]),t._v(" "),o("b-input-group",[o("autocomplete",{ref:"autocompleteProducto",attrs:{url:t.API+"productos",onShouldRenderChild:t.renderChild,anchor:"Producto",label:"writer",placeholder:"Agregar Producto","on-select":t.setProducto,onFocus:t.focusAutocomplete.bind(null,"autocompleteProducto"),classes:{input:"form-control"}}}),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.loadCode,expression:"loadCode"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Codigo de Barra"},domProps:{value:t.loadCode},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?(e.preventDefault(),t.loadBarcode(e)):null},input:function(e){e.target.composing||(t.loadCode=e.target.value)}}}),t._v(" "),o("b-input-group-append",[o("producto-form",{attrs:{showButton:t.showButton,cbGuardar:function(e){return t.add([e])}}})],1)],1)],1),t._v(" "),o("b-table",{ref:"tablaCarrito",attrs:{small:"",responsive:"",striped:"",hover:"",items:t.productos,fields:t.fields},scopedSlots:t._u([{key:"cantidad",fn:function(e){return[o("b-form-input",{staticStyle:{width:"75px"},attrs:{type:"number",min:"0",placeholder:"Cantidad"},on:{input:function(e){return t.$emit("onInputCantidad",e)}},model:{value:t.productos[e.index].cantidad,callback:function(o){t.$set(t.productos[e.index],"cantidad",o)},expression:"productos[data.index].cantidad"}})]}},{key:"precio",fn:function(e){return[o("b-form-input",{staticStyle:{width:"75px"},attrs:{type:"number",min:"0",step:"0.00001",placeholder:"Precio"},on:{input:function(o){t.setNuevoPrecioContado(e.index)}},model:{value:t.productos[e.index].precio,callback:function(o){t.$set(t.productos[e.index],"precio",o)},expression:"productos[data.index].precio"}})]}},{key:"subtotal",fn:function(e){return[t._v("\n        "+t._s(t.getSubtotal(e.index))+"\n      ")]}},{key:"igv",fn:function(e){return[o("b-form-checkbox",{attrs:{value:1,"unchecked-value":0},on:{input:function(o){t.setNuevoPrecioContado(e.index)}},model:{value:t.productos[e.index].TieneIgv,callback:function(o){t.$set(t.productos[e.index],"TieneIgv",o)},expression:"productos[data.index].TieneIgv"}},[o("div",[t._v(t._s(t.getIgv(e.index)))])])]}},{key:"precioVenta",fn:function(e){return[o("b-form-input",{staticStyle:{width:"80px"},attrs:{type:"number",min:"0",step:"0.01",placeholder:"Precio Venta"},model:{value:t.productos[e.index].nuevoPrecioContado,callback:function(o){t.$set(t.productos[e.index],"nuevoPrecioContado",o)},expression:"productos[data.index].nuevoPrecioContado"}}),t._v(" "),o("b-form-text",[o("strike",[t._v(" "+t._s(t.productos[e.index].normalPrecioContado)+" ")])],1)]}},{key:"descuento",fn:function(e){return[o("b-form-input",{attrs:{type:"number",min:"0",step:"0.01",value:0},model:{value:t.productos[e.index].descuento,callback:function(o){t.$set(t.productos[e.index],"descuento",o)},expression:"productos[data.index].descuento"}}),t._v(" "),o("b-form-text")]}},{key:"FechaAlquiler",fn:function(e){return[o("b-form-input",{attrs:{type:"date",placeholder:"Fecha Fin",value:t.formatFecha(e.item.FechaAlquiler)},model:{value:t.productos[e.index].FechaAlquilerInicio,callback:function(o){t.$set(t.productos[e.index],"FechaAlquilerInicio",o)},expression:"productos[data.index].FechaAlquilerInicio"}})]}},{key:"FechaAlquilerFin",fn:function(e){return[o("b-form-input",{attrs:{type:"date",placeholder:"Fecha Fin",value:t.$moment().format("YYYY-MM-DD")},model:{value:t.productos[e.index].FechaAlquilerFin,callback:function(o){t.$set(t.productos[e.index],"FechaAlquilerFin",o)},expression:"productos[data.index].FechaAlquilerFin"}})]}},{key:"Descripcion",fn:function(e){return[o("b-form-input",{attrs:{type:"text",placeholder:"Descripción"},model:{value:t.productos[e.index].Descripcion,callback:function(o){t.$set(t.productos[e.index],"Descripcion",o)},expression:"productos[data.index].Descripcion"}})]}},{key:"total",fn:function(e){return[t._v("\n        "+t._s(t.getTotal(e.index))+"\n      ")]}},{key:"acciones",fn:function(e){return[o("b-button",{attrs:{variant:"danger",size:"sm"},on:{click:function(o){t.quitarProducto(e.index)}}},[t._v("X")])]}},{key:"show_details",fn:function(e){return[o("b-button",{attrs:{size:"sm",variant:"info"},on:{click:function(t){return t.stopPropagation(),e.toggleDetails(t)}}},[t._v(">")])]}},{key:"row-details",fn:function(t){}},{key:"stock",fn:function(e){return[e.item.EsPadre?o("img",{staticStyle:{width:"24px"},attrs:{src:"static/box.png"}}):t._e(),t._v(" "),e.item.EsPadre?t._e():o("div",[t._v(t._s(e.item.stock))])]}}])})],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[t._t("operaciones")],2),t._v(" "),o("b-col",{attrs:{md:"4"}},[t._t("metodopago")],2),t._v(" "),o("b-col",{attrs:{md:"3","offset-md":"2"}},[o("table",{staticClass:"table b-table border table-footer"},[o("tbody",[t.sumatoriaDescuento>0?o("tr",[o("td",{staticClass:"table-success"},[t._v("SubTotal")]),t._v(" "),o("td",{staticClass:"table-success"},[t._v(t._s(t._f("redondear")(parseFloat(t.sumatoriaSubTotal)+parseFloat(t.sumatoriaDescuento))))])]):t._e(),t._v(" "),t.sumatoriaDescuento>0?o("tr",[o("td",{staticClass:"table-danger"},[t._v("Descuento")]),t._v(" "),o("td",{staticClass:"table-danger"},[t._v("- "+t._s(t.sumatoriaDescuento))])]):t._e(),t._v(" "),o("tr",[o("td",[o("b",[t._v("SubTotal")])]),t._v(" "),o("td",{staticClass:"table-danger"},[t._v(t._s(t.sumatoriaSubTotal))])]),t._v(" "),t.sumatoriaIgv>0?o("tr",[o("td",[o("b",[t._v("IGV")])]),t._v(" "),o("td",{staticClass:"table-danger"},[t._v(t._s(t.sumatoriaIgv))])]):t._e(),t._v(" "),o("tr",[o("td",[o("b",[t._v("TOTAL")])]),t._v(" "),o("td",{staticClass:"table-danger"},[t._v(t._s(t.sumatoriaTotal))])]),t._v(" "),o("tr",[o("td",{attrs:{colspan:"2"}},[o("label",[t._v("pagó con:")]),t._v(" "),o("b-form-input",{attrs:{type:"text",placeholder:"Pagó con"},on:{input:t.asignarVuelto},model:{value:t.pagocon,callback:function(e){t.pagocon=e},expression:"pagocon"}}),o("br"),t._v(" "),o("label",[t._v("Vuelto:")]),t._v(" "),o("b",[t._v("S/  "+t._s(t._f("redondear")(t.vuelto)))])],1)])])])]),t._v(" "),o("br"),o("br")],1)},staticRenderFns:[]};var y=o("VU/8")(x,w,!1,function(t){o("OmDo")},null,null).exports,D={data:function(){return{API:v.a.API,show:!1,proveedor:{Proveedor:"",Ruc:"",Direccion:"",Observacion:"",FechaReg:null}}},props:["newRuc"],methods:{shownProveedorForm:function(){this.proveedor.Ruc=this.$parent.$parent.newRuc,this.proveedor.Direccion="",this.proveedor.Proveedor=""},consultarRUC:function(){var t=this;this.axios.get(this.API+"consultarRUC",{params:{type:"RUC",numero:this.proveedor.Ruc}}).then(function(e){t.$toasted.show("Proveedor encontrado, se llenarán sus datos");var o=e.data.result;t.proveedor.Proveedor=o.RazonSocial,t.proveedor.Direccion=o.Direccion}).catch(function(e){t.$toasted.show("No se encontró el RUC"),console.log(e)})},guardarProveedor:function(){var t=this;this.axios.post(this.API+"proveedores",this.proveedor).then(function(e){t.$toasted.show("Proveedor guardado correctamente"),t.$refs.proveedorForm.hide()}).catch(function(e){t.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})}}},S={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-btn",{directives:[{name:"b-modal",rawName:"v-b-modal.modal1",modifiers:{modal1:!0}}],attrs:{variant:"primary"}},[t._v("Nuevo")]),t._v(" "),o("b-modal",{ref:"proveedorForm",attrs:{id:"modal1",title:"Nuevo Proveedor",size:"lg"},on:{shown:t.shownProveedorForm},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("b-row",[o("b-col",{attrs:{md:"12"}},[o("b-form-group",[o("label",[t._v("RUC:")]),t._v(" "),o("b-input-group",[o("b-form-input",{model:{value:t.proveedor.Ruc,callback:function(e){t.$set(t.proveedor,"Ruc",e)},expression:"proveedor.Ruc"}}),t._v(" "),o("b-input-group-append",[o("b-btn",{attrs:{variant:"info"},on:{click:t.consultarRUC}},[t._v("Buscar RUC")])],1)],1)],1),t._v(" "),o("b-form-group",[o("label",[t._v("Nombre del Proveedor:")]),t._v(" "),o("b-form-input",{attrs:{type:"text"},model:{value:t.proveedor.Proveedor,callback:function(e){t.$set(t.proveedor,"Proveedor",e)},expression:"proveedor.Proveedor"}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Dirección:")]),t._v(" "),o("b-form-input",{attrs:{type:"text"},model:{value:t.proveedor.Direccion,callback:function(e){t.$set(t.proveedor,"Direccion",e)},expression:"proveedor.Direccion"}})],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"modal-footer"},slot:"modal-footer"},[o("b-btn",{attrs:{variant:"primary"},on:{click:t.guardarProveedor}},[t._v("\n         Guardar\n       ")]),t._v(" "),o("b-btn",{attrs:{variant:"secondary"},on:{click:function(e){t.show=!1}}},[t._v("\n         Close\n       ")])],1)],1)],1)},staticRenderFns:[]};var F=o("VU/8")(D,S,!1,function(t){o("SyeH")},null,null).exports,V={mounted:function(){},data:function(){return{inProgress:!1,newRuc:"",API:v.a.API,ultimoMovimiento:"",movimiento:this.initMovimiento()}},computed:c()({},Object(d.c)({proveedoresFiltrados:function(t){return t.proveedoresFiltrados},almacenes:function(t){return t.almacenesFiltrados},productos:function(t){return t.cart.productos}})),methods:c()({},Object(d.b)({buscarProveedores:"buscarProveedores",buscarAlmacenes:"buscarAlmacenes",limpiar:"limpiarCarrito"}),{afe:function(t){return!1},cargarNumero:function(){var t=this;this.axios.get(this.API+"movimientos/numero",{params:{serie:this.movimiento.Serie,idMovimientoTipo:this.movimiento.movimientoTipo.IdMovimientoTipo}}).then(function(e){Vue.set(t.movimiento,"Numero",e.data.NuevoNumero||"0001")}).catch(function(t){console.log(t)})},initMovimiento:function(){var t=this.$moment().month()+1;return t=t<10?"0"+t:t,{EsCredito:0,alterarProductos:1,FechaVenCredito:"",Moneda:"PEN",FechaPeriodoTributario:this.$moment().year()+""+t,MovimientoFecha:"chrome"==this.$browser.name?this.$moment().format("YYYY-MM-DDThh:mm:ss"):this.$moment().format("YYYY-MM-DD hh:mm:ss"),FechaStock:this.$moment().format("YYYY-MM-DD"),TipoCambio:1,proveedor:{IdProveedor:0},movimientoTipo:{},almacenOrigen:{IdAlmacen:-1},almacenDestino:{IdAlmacen:-1}}},onReset:function(t){t.preventDefault()},setTipoMovimiento:function(t){0==t.Tipo?(this.movimiento.almacenOrigen={IdAlmacen:-1},this.movimiento.almacenDestino={IdAlmacen:1}):1==t.Tipo?(this.movimiento.almacenDestino={IdAlmacen:-1},this.movimiento.almacenOrigen={IdAlmacen:1}):(this.movimiento.almacenDestino={IdAlmacen:1},this.movimiento.almacenOrigen={IdAlmacen:1}),this.movimiento.movimientoTipo=t,this.cargarNumero()},setProveedor:function(t){this.movimiento.proveedor=t},setAlmacenOrigen:function(t){this.movimiento.almacenOrigen=t},setAlmacenDestino:function(t){this.movimiento.almacenDestino=t},setMoneda:function(t){this.movimiento.Moneda=t.Moneda},getProveedores:function(t){this.buscarProveedores(t)},getAlmacenes:function(t){this.buscarAlmacenes(t)},guardarMovimiento:function(t){var e=this;if(t.preventDefault(),this.inProgress=!0,!this.movimiento.proveedor.IdProveedor)return this.$toasted.show("Por favor seleccione un proveedor"),void(this.inProgress=!1);if(!this.productos.length)return this.$toasted.show("No ha seleccionado ningun producto"),void(this.inProgress=!1);var o=!1;if(this.productos.forEach(function(t,e){t.total<=0&&(o=!0)}),o&&this.movimiento.alterarProductos)return this.$toasted.show("Falta llenar cantidad / precio"),void(this.inProgress=!1);this.axios.post(this.API+"movimientos",{movimiento:this.movimiento,productos:this.productos}).then(function(t){t.data.error?e.$toasted.show(t.data.error):(e.ultimoMovimiento=t.data.hash,e.movimiento=e.initMovimiento(),e.limpiar(),e.$refs.inputMovimiento.setValue(""),e.$refs.inputProveedor.setValue(""),e.$toasted.show("Movimiento guardado correctamente ")),e.inProgress=!1}).catch(function(t){e.$toasted.show("Ha ocurrido un error, vuelva a intentarlo"),e.inProgress=!1})},focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()}}),components:{Menu:u,ProductosCarrito:y,ProveedoresForm:F}},$={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t._e(),t._v(" "),o("br"),t._v(" "),o("b-form",{attrs:{validated:""},on:{submit:t.guardarMovimiento,reset:t.onReset,keyup:t.afe}},[o("b-container",{staticClass:"bv-example-row"},[o("b-row",[o("b-col",{attrs:{md:"8"}},[o("b-row",[o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Tipo de Movimiento:")]),t._v(" "),o("autocomplete",{ref:"inputMovimiento",attrs:{required:"required",url:t.API+"movimientos/tipos",anchor:"TipoMovimiento",label:"writer",placeholder:"","on-select":t.setTipoMovimiento,onFocus:t.focusAutocomplete.bind(null,"inputMovimiento"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"8"}},[o("b-form-group",[o("label",[t._v("Proveedor:")]),t._v(" "),o("b-input-group",[o("autocomplete",{ref:"inputProveedor",attrs:{required:"required",url:t.API+"proveedores",anchor:"ProveedorRuc",label:"writer",placeholder:"",onInput:function(e){return t.newRuc=e},"on-select":t.setProveedor,onFocus:t.focusAutocomplete.bind(null,"inputProveedor"),classes:{input:"form-control"}}}),t._v(" "),o("b-input-group-append",[o("proveedores-form",{attrs:{ruc:t.newRuc}})],1)],1)],1)],1)],1),t._v(" "),o("b-row",[o("b-col",{attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Periodo Tributario:")]),t._v(" "),o("b-form-input",{attrs:{type:"text",readonly:"readonly",placeholder:"Periodo Tributario"},model:{value:t.movimiento.FechaPeriodoTributario,callback:function(e){t.$set(t.movimiento,"FechaPeriodoTributario",e)},expression:"movimiento.FechaPeriodoTributario"}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[1==t.movimiento.movimientoTipo.Tipo||2==t.movimiento.movimientoTipo.Tipo?o("b-form-group",[o("label",[t._v("Almacen Origen:")]),t._v(" "),o("autocomplete",{ref:"inputAlmacenOrigen",attrs:{required:"required",initValue:"VENTA",url:t.API+"almacenes",anchor:"Almacen",label:"writer",placeholder:"","on-select":t.setAlmacenOrigen,onFocus:t.focusAutocomplete.bind(null,"inputAlmacenOrigen"),classes:{input:"form-control"}}})],1):t._e()],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[0==t.movimiento.movimientoTipo.Tipo||2==t.movimiento.movimientoTipo.Tipo?o("b-form-group",[o("label",[t._v("Almacen Destino:")]),t._v(" "),o("autocomplete",{ref:"inputAlmacenDestino",attrs:{required:"required",initValue:"VENTA",url:t.API+"almacenes",anchor:"Almacen",label:"writer",placeholder:"","on-select":t.setAlmacenDestino,onFocus:t.focusAutocomplete.bind(null,"inputAlmacenDestino"),classes:{input:"form-control"}}})],1):t._e()],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[o("b-form-group",{attrs:{label:"Credito: "}},[o("b-form-checkbox",{attrs:{id:"checkbox1",value:1,"unchecked-value":0},model:{value:t.movimiento.EsCredito,callback:function(e){t.$set(t.movimiento,"EsCredito",e)},expression:"movimiento.EsCredito"}},[t._v("\n                      Pago pendiente\n                    ")]),t._v(" "),t.movimiento.EsCredito?o("b-form-input",{attrs:{type:"date",placeholder:"Fecha Vencimiento"},model:{value:t.movimiento.FechaVenCredito,callback:function(e){t.$set(t.movimiento,"FechaVenCredito",e)},expression:"movimiento.FechaVenCredito"}}):t._e()],1)],1)],1),t._v(" "),o("b-row",[o("b-col",{attrs:{md:"6"}},[o("b-form-group",[o("b-form-checkbox",{attrs:{id:"alterar-productos",value:1,"unchecked-value":0},model:{value:t.movimiento.alterarProductos,callback:function(e){t.$set(t.movimiento,"alterarProductos",e)},expression:"movimiento.alterarProductos"}},[t._v("\n                      Alterar precio productos\n                    ")])],1)],1)],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("b-row",[o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Serie:")]),t._v(" "),o("b-form-input",{attrs:{required:"required",type:"text",placeholder:""},on:{input:t.cargarNumero},model:{value:t.movimiento.Serie,callback:function(e){t.$set(t.movimiento,"Serie",e)},expression:"movimiento.Serie"}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Número:")]),t._v(" "),o("b-form-input",{attrs:{required:"required",type:"text",placeholder:""},model:{value:t.movimiento.Numero,callback:function(e){t.$set(t.movimiento,"Numero",e)},expression:"movimiento.Numero"}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Moneda:")]),t._v(" "),o("autocomplete",{attrs:{url:t.API+"monedas",initValue:"PEN",anchor:"Moneda",label:"writer",placeholder:"Moneda","on-select":t.setMoneda,classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"8"}},[o("b-form-group",[o("label",[t._v("Fecha Contable:")]),t._v(" "),o("b-form-input",{attrs:{type:"datetime-local",step:"1",placeholder:"Fecha Contable",disabled:"disabled"},model:{value:t.movimiento.MovimientoFecha,callback:function(e){t.$set(t.movimiento,"MovimientoFecha",e)},expression:"movimiento.MovimientoFecha"}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Fecha Stock:")]),t._v(" "),o("b-form-input",{attrs:{type:"date",placeholder:"Fecha Stock",disabled:"disabled"},model:{value:t.movimiento.FechaStock,callback:function(e){t.$set(t.movimiento,"FechaStock",e)},expression:"movimiento.FechaStock"}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Tipo de cambio:")]),t._v(" "),o("b-form-input",{attrs:{type:"number",placeholder:"Tipo de cambio"},model:{value:t.movimiento.TipoCambio,callback:function(e){t.$set(t.movimiento,"TipoCambio",e)},expression:"movimiento.TipoCambio"}})],1)],1)],1)],1)],1),t._v(" "),o("b-row",[o("b-col",[o("productos-carrito",{ref:"carrito"})],1)],1),t._v(" "),o("b-row",{staticClass:"text-center",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"4"}},[o("b-button",{attrs:{variant:"success",size:"lg",type:"submit",disabled:t.inProgress}},[t._v("Guardar")]),t._v(" "),t.ultimoMovimiento?o("b-button",{attrs:{target:"_blank",variant:"info",size:"lg",href:"/views/codigoBarra.php?hash="+t.ultimoMovimiento}},[t._v("Código de Barra")]):t._e()],1)],1)],1),t._v(" "),o("br"),o("br")],1)],1)},staticRenderFns:[]};var T=o("VU/8")(V,$,!1,function(t){o("hJma")},null,null).exports,M={mounted:function(){var t=this;this.axios.get(this.API+"productos/count").then(function(e){t.totalRows=e.data.total})},data:function(){return{API:v.a.API,pageOptions:[5,10,15,50,100],filter:null,sortBy:"IdProducto",sortDesc:!1,productoSelect:{},items:[],isBusy:!1,fields:[{key:"CodigoBarra",label:"Codigo",sortable:!0},{key:"Producto",sortable:!0},{key:"ProductoCategoria",label:"Categoría",sortable:!0},{key:"ProductoMarca",label:"Marca",sortable:!0},{key:"ProductoMedicion",label:"Medición",sortable:!0},{key:"ProductoPresentacion",label:"Presentación",sortable:!0}],totalRows:50,perPage:10,currentPage:1}},methods:{rowClick:function(t,e){this.productoSelect=t,this.$refs.productoForm.show=!0},actualizarTabla:function(){this.$refs.tablaProductos.refresh()},nuevoProducto:function(){this.productoSelect={},this.$refs.productoForm.show=!0},myProvider:function(t){var e=this,o=this.API+"productos?limit="+t.perPage+"&page="+t.currentPage+"&filter="+(t.filter||"")+"&sortBy="+t.sortBy;return o+="&sortDesc="+(t.sortDesc?1:0),this.axios.get(o).then(function(t){return e.items=t.data,e.items}).catch(function(t){return[]})}},components:{ProductoForm:A}},E={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-container",{staticClass:"bv-example-row"},[o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"6"}},[o("b-form-group",{staticClass:"mb-0",attrs:{horizontal:"",label:"Buscar"}},[o("b-input-group",[o("b-form-input",{attrs:{placeholder:"Buscar"},on:{input:function(e){t.currentPage=1}},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),o("b-input-group-append",[o("b-btn",{attrs:{disabled:!t.filter},on:{click:function(e){t.filter=""}}},[t._v("Limpiar")])],1)],1)],1),t._v(" "),o("br")],1),t._v(" "),o("b-col",{staticClass:"my-1",attrs:{md:"6"}},[o("b-row",[o("b-col",{attrs:{md:"8"}},[o("b-form-group",{staticClass:"mb-0",attrs:{horizontal:"",label:"Mostrar"}},[o("b-form-select",{attrs:{options:t.pageOptions},on:{input:function(e){t.currentPage=1}},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("p",{staticStyle:{"margin-top":"6px"}},[t._v("de "),o("b",{staticClass:"text-success"},[t._v(t._s(this.totalRows))]),t._v(" Artículos")])])],1)],1),t._v(" "),o("b-table",{ref:"tablaProductos",attrs:{small:"",filter:t.filter,"sort-by":t.sortBy,"sort-desc":t.sortDesc,striped:"",hover:"",id:"my-table",busy:t.isBusy,items:t.myProvider,fields:t.fields,"per-page":t.perPage,"current-page":t.currentPage},on:{"update:sortBy":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"row-clicked":t.rowClick,"update:busy":function(e){t.isBusy=e}}}),t._v(" "),o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"6"}},[o("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1),t._v(" "),o("producto-form",{ref:"productoForm",attrs:{"producto-update":t.productoSelect,cbGuardar:t.actualizarTabla}}),t._v(" "),o("br"),t._v(" "),o("b-row",{staticClass:"text-center",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"4"}},[o("b-button",{attrs:{variant:"success",size:"lg"},on:{click:t.nuevoProducto}},[t._v("Nuevo")])],1)],1),t._v(" "),o("br"),o("br")],1)],1)},staticRenderFns:[]};var R=o("VU/8")(M,E,!1,function(t){o("2BCl")},null,null).exports,j=o("fZjL"),N=o.n(j),O={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"table-responsive"},[o("table",{staticClass:"table b-table table-sm"},[t._m(0),t._v(" "),o("tbody",t._l(t.kardexSaldo,function(e,a){return o("tr",{key:a},[o("td",[t._v(t._s(e.Fecha))]),t._v(" "),o("td",[t._v(t._s(e.Detalle)+" - "+t._s(e.Serie)+" - "+t._s(e.Numero))]),t._v(" "),o("td",[t._v(t._s(e.Nombres))]),t._v(" "),o("td",{class:{"table-warning":e.IngresoCantidad>0}},[t._v(t._s(e.IngresoCantidad))]),t._v(" "),o("td",{class:{"table-warning":e.IngresoPrecio>0}},[t._v(t._s(t._f("redondear")(e.IngresoPrecio)))]),t._v(" "),o("td",{class:{"table-warning":e.SalidaCantidad>0}},[t._v(t._s(e.SalidaCantidad))]),t._v(" "),o("td",{class:{"table-warning":e.SalidaPrecio>0}},[t._v(t._s(t._f("redondear")(e.SalidaPrecio)))]),t._v(" "),o("td",{staticClass:"table-danger"},[t._v(t._s(e.saldo))])])}))])])},staticRenderFns:[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("thead",[o("tr",[o("th",{attrs:{rowspan:"2"}},[t._v("FECHA")]),t._v(" "),o("th",{attrs:{rowspan:"2"}},[t._v("COMPROBANTE")]),t._v(" "),o("th",{attrs:{rowspan:"2"}},[t._v("PROVEEDOR/CLIENTE")]),t._v(" "),o("th",{attrs:{colspan:"2"}},[t._v("INGRESOS")]),t._v(" "),o("th",{attrs:{colspan:"2"}},[t._v("SALIDAS")]),t._v(" "),o("th",{staticClass:"table-danger",attrs:{rowspan:"2"}},[t._v("SALDO")])]),t._v(" "),o("tr",[o("th",[t._v("Cant.")]),t._v(" "),o("th",[t._v("Precio.")]),t._v(" "),o("th",[t._v("Cant.")]),t._v(" "),o("th",[t._v("Precio.")])])])}]};var B=o("VU/8")({mounted:function(){},data:function(){return{saldo:0}},props:["producto","kardex"],methods:{getSaldo:function(t){var e=0;return e+10}},computed:{kardexSaldo:function(){var t=0;return this.kardex.map(function(e){return t+=e.IngresoCantidad-e.SalidaCantidad,e.saldo=t,e})}}},O,!1,function(t){o("BSPH")},"data-v-6e5c36de",null).exports,q={mounted:function(){var t=this;this.axios.get(this.API+"productos/count").then(function(e){t.totalRows=e.data.total})},data:function(){return{API:v.a.API,sumaStock:"...",sumaValorizado:"...",APISTOCK:"productos",tipoStock:"",showKardex:!1,almacen:{IdAlmacen:1,Almacen:"VENTA"},pageOptions:[5,10,15,50,100],filters:{},filter:"",sortBy:"IdProducto",sortDesc:!1,productoSelect:{},kardexSelect:[],items:[],itemsStock:[],isBusy:!1,fields:[{key:"CodigoBarra",label:"Código",sortable:!0},{key:"ProductoCategoria",label:"Categoría",sortable:!0},{key:"Producto",sortable:!0},{key:"ProductoMarca",label:"Marca",sortable:!0},{key:"ProductoPresentacion",label:"Present.",sortable:!0},{key:"ProductoMedicion",label:"Medición",sortable:!0},{key:"stock",sortable:!1,variant:"",class:"text-center"}],totalRows:50,perPage:10,currentPage:1}},watch:{items:function(t){var e=this;this.axios.get(this.API+"productos/stock",{params:{idProductos:t.map(function(t){return t.IdProducto}),idAlmacen:this.almacen.IdAlmacen}}).then(function(t){e.itemsStock=t.data}).catch(function(t){console.log(t)}),this.getSumaStock(),this.getSumaValorizado()}},computed:{titleKardex:function(){return"KARDEX - / "+this.productoSelect.CodigoBarra+" / "+this.productoSelect.Producto+" / "+this.productoSelect.ProductoMarca+" / "+this.productoSelect.ProductoPresentacion+" / "+this.productoSelect.ProductoMedicion}},methods:{getSumaValorizado:function(){var t=this;this.axios.get(this.API+"productos/stock?idAlmacen="+this.almacen.IdAlmacen+"&filter="+(this.filter||"")+"&filter[stock]=mayor&sumaValorizado=1").then(function(e){t.sumaValorizado=e.data[0].sumaValorizado})},getSumaStock:function(){var t=this;this.axios.get(this.API+"productos/stock?idAlmacen="+this.almacen.IdAlmacen+"&filter="+(this.filter||"")+"&filter[stock]=mayor&sumaStock=1").then(function(e){t.sumaStock=e.data[0].sumaStock})},getStock:function(t){var e=this.itemsStock.findIndex(function(e){return e.IdProducto==t});return this.itemsStock[e]&&this.itemsStock[e].stock},focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()},limpiarClassRows:function(){var t=this.$refs.tablaProductos.$el.rows;N()(t).forEach(function(e){t[e].classList.remove("table-info")})},setAlmacen:function(t){var e=this;this.almacen=t,this.limpiarFiltros(),console.log(this.filter),Vue.nextTick(function(){return e.$refs.tablaProductos.refresh()})},rowClick:function(t,e,o){this.limpiarClassRows(),o.target.parentNode.classList.add("table-info"),this.productoSelect=t},rowDblClick:function(t){var e=this;this.productoSelect=t,this.showKardex=!0,this.axios.get(this.API+"productos/kardex/"+this.productoSelect.IdProducto+"?limit=0",{params:{idAlmacen:this.almacen.IdAlmacen,fechaHasta:this.$moment().format("YYYY-MM-DDTH:mm:ss")}}).then(function(t){e.kardexSelect=t.data})},actualizarTabla:function(){this.$refs.tablaProductos.refresh()},myProvider:function(t){var e=this,o=this.API+this.APISTOCK+"?idAlmacen="+this.almacen.IdAlmacen+"&limit="+t.perPage+"&page="+t.currentPage+"&filter="+(t.filter||"")+"&sortBy="+t.sortBy+"&controlaStock=1";return console.log(o),o+="&sortDesc="+(t.sortDesc?1:0),this.axios.get(o).then(function(t){return e.items=t.data,e.items}).catch(function(t){return[]})},limpiarFiltros:function(){this.APISTOCK="productos",this.tipoStock="",this.filters={},this.filter="",this.$refs.inputCategoria.setValue(""),this.$refs.inputProducto.setValue(""),this.$refs.inputMarca.setValue(""),this.$refs.inputPresentacion.setValue(""),this.productoSelect={},this.limpiarClassRows(),console.log(this.filter)},generateFilter:function(t,e){this.filters[t]=e;var o="";for(var t in this.filters)o+="&filter["+t+"]="+this.filters[t],"stock"!=t&&"minimo"!=t||(this.APISTOCK="productos/stock");this.filter=o},exportarProductos:function(){}},components:{ProductoKardex:B}},z={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-container",{staticClass:"bv-example-row",attrs:{fluid:""}},[o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"12"}},[o("b-row",[o("b-col",{attrs:{md:"2"}},[o("div",{staticClass:"suma-stock text-center"},[o("b",[t._v("Stock Valorizado")]),t._v(" "),o("div",[t._v(" S/. "+t._s(t._f("moneda")(t.sumaValorizado))+" ")])])]),t._v(" "),o("b-col",{attrs:{md:"2"}},[o("div",{staticClass:"suma-stock text-center"},[o("b",[t._v("Stock General")]),t._v(" "),o("div",[t._v(" "+t._s(t.sumaStock)+" ")])])]),t._v(" "),o("b-col",{attrs:{md:"2"}},[o("b-form-group",[o("label",[t._v("Almacen:")]),t._v(" "),o("autocomplete",{ref:"inputAlmacen",attrs:{required:"required",url:t.API+"almacenes",anchor:"Almacen",initValue:"VENTA",label:"writer",placeholder:"","on-select":t.setAlmacen,onFocus:t.focusAutocomplete.bind(null,"inputAlmacen"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"2"}},[o("b-form-group",{attrs:{label:"Tipo de Muestra"}},[o("b-form-radio-group",{attrs:{"button-variant":"primary",buttons:"",name:"butons1",options:[{text:"Stock > 0",value:"mayor"},{text:"Stock <= 0",value:"menor"}]},on:{change:function(e){return t.generateFilter("stock",e)}},model:{value:t.tipoStock,callback:function(e){t.tipoStock=e},expression:"tipoStock"}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"1"}},[o("b-form-group",{attrs:{label:"Limpiar "}},[o("b-button",{attrs:{disabled:!t.filter},on:{click:t.limpiarFiltros}},[t._v("Limpiar")])],1),t._v(" "),o("br")],1),t._v(" "),o("b-col",{attrs:{md:"1"}},[o("b-form-group",{attrs:{label:"Stock Mínimo"}},[o("b-form-checkbox",{attrs:{id:"stock",value:1,"unchecked-value":0},on:{change:function(e){return t.generateFilter("minimo",e)}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"2"}},[o("b-form-group",{attrs:{label:"Mostrar"}},[o("b-form-select",{attrs:{options:t.pageOptions},on:{input:function(e){t.currentPage=1}},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1)],1)],1)],1),t._v(" "),o("b-row",[o("b-col",{attrs:{md:"6"}},[o("b-row",[o("b-col",{attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Categoría:")]),t._v(" "),o("autocomplete",{ref:"inputCategoria",attrs:{url:t.API+"categorias",anchor:"ProductoCategoria",label:"writer","on-select":function(e){return t.generateFilter("categoria",e.ProductoCategoria)},onInput:function(e){return!e&&t.generateFilter("categoria",e)},classes:{input:"form-control upper"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Producto:")]),t._v(" "),o("autocomplete",{ref:"inputProducto",attrs:{url:t.API+"productos",anchor:"Producto",label:"writer","on-select":function(e){return t.generateFilter("producto",e.Producto)},onInput:function(e){return t.generateFilter("producto",e)},classes:{input:"form-control upper"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Marca:")]),t._v(" "),o("autocomplete",{ref:"inputMarca",attrs:{url:t.API+"marcas",anchor:"ProductoMarca",label:"writer","on-select":function(e){return t.generateFilter("marca",e.ProductoMarca)},onInput:function(e){return!e&&t.generateFilter("marca",e)},classes:{input:"form-control upper"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Presentación:")]),t._v(" "),o("autocomplete",{ref:"inputPresentacion",attrs:{url:t.API+"productos/presentaciones",anchor:"ProductoPresentacion",label:"writer","on-select":function(e){return t.generateFilter("presentacion",e.ProductoPresentacion)},onInput:function(e){return!e&&t.generateFilter("presentacion",e)},classes:{input:"form-control upper"}}})],1)],1)],1)],1),t._v(" "),o("b-col",{attrs:{md:"6"}},[o("b-row",[o("b-col",{attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Medición:")]),t._v(" "),o("autocomplete",{ref:"inputMedicion",attrs:{url:t.API+"mediciones",anchor:"ProductoMedicion",label:"writer","on-select":function(e){return t.generateFilter("medicion",e.Genero)},onInput:function(e){return!e&&t.generateFilter("medicion",e)},classes:{input:"form-control upper"}}})],1)],1)],1)],1)],1),t._v(" "),o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"12"}},[o("table",{staticClass:"table border b-table table-footer table-sm table-detalle"},[o("thead",[o("tr",[o("th",[t._v("Producto")]),t._v(" "),o("th",{staticClass:"text-center"},[t._v("Precio de compra")]),t._v(" "),o("th",{staticClass:"text-center"},[t._v("Precio de venta")]),t._v(" "),o("th",{staticClass:"text-center"},[t._v("Stock")])])]),t._v(" "),o("tbody",[o("tr",[o("td",[t._v(t._s(t.productoSelect.Producto))]),t._v(" "),o("td",{staticClass:"text-center"},[t._v(t._s(t.productoSelect.PrecioCosto))]),t._v(" "),o("td",{staticClass:"text-center"},[t._v(t._s(t.productoSelect.PrecioContado))]),t._v(" "),o("td",{staticClass:"text-center table-info"},[t._v(t._s(t.getStock(t.productoSelect.IdProducto)))])])])])]),t._v(" "),o("b-col",{attrs:{md:"12"}},[o("b-table",{ref:"tablaProductos",attrs:{small:"",filter:t.filter,"sort-by":t.sortBy,"sort-desc":t.sortDesc,striped:"",hover:"",id:"tabla-productos",busy:t.isBusy,items:t.myProvider,fields:t.fields,"per-page":t.perPage,"current-page":t.currentPage},on:{"update:sortBy":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"row-clicked":t.rowClick,"row-dblclicked":t.rowDblClick,"update:busy":function(e){t.isBusy=e}},scopedSlots:t._u([{key:"stock",fn:function(e){return[o("div",{class:t.getStock(e.item.IdProducto)>0?"table-success":"table-danger",on:{click:function(t){return t.stopPropagation(),!1}}},[t._v("\n                  "+t._s(t.getStock(e.item.IdProducto))+"\n                ")]),t._v(" "),void 0===t.getStock(e.item.IdProducto)?o("img",{staticStyle:{width:"24px"},attrs:{src:"static/box.png"}}):t._e()]}}])})],1),t._v(" "),o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"6"}},[o("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1),t._v(" "),o("br"),t._v(" "),o("b-row",{staticClass:"text-center",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"4"}},[o("b-button",{attrs:{variant:"success",size:"lg",href:"/api/index.php/reporte/stock?idAlmacen="+t.almacen.IdAlmacen,target:"_blank"}},[t._v("Exportar")])],1)],1),t._v(" "),o("br"),o("br")],1),t._v(" "),o("b-modal",{attrs:{id:"kardex",size:"lg","modal-class":"modal-xl",title:"Kardex de producto"},model:{value:t.showKardex,callback:function(e){t.showKardex=e},expression:"showKardex"}},[o("b-alert",{attrs:{show:"",variant:"warning"}},[t._v(t._s(t.titleKardex))]),t._v(" "),o("producto-kardex",{attrs:{producto:t.productoSelect,kardex:t.kardexSelect}})],1)],1)},staticRenderFns:[]};var U=o("VU/8")(q,z,!1,function(t){o("shh4")},null,null).exports,Y=o("pFYg"),H=o.n(Y),L={mounted:function(){document.body.appendChild(this.$refs.form)},data:function(){return{API:v.a.API,show:!1,cliente:{Cliente:"",DniRuc:"",Direccion:"",Telefono:"",Email:"",Sexo:"",Ocupacion:"",FechaNacimiento:"",Nacionalidad:""}}},props:["newDniRuc","index"],computed:{},methods:{shownClienteForm:function(){console.log("show"),this.cliente.DniRuc=this.$parent.$parent.newDniRuc,this.cliente.Direccion="",this.cliente.Cliente="",this.cliente.Telefono="",this.cliente.Email="",this.cliente.Sexo="",this.cliente.Ocupacion="",this.cliente.FechaNacimiento="",this.cliente.Nacionalidad=""},consultarDNIRUC:function(){var t=this,e=this.cliente.DniRuc.length>8?"RUC":"DNI";this.axios.get(this.API+"consultarRUC",{params:{type:e,numero:this.cliente.DniRuc}}).then(function(o){if(o.data){t.$toasted.show("Cliente encontrado, se llenarán sus datos");var a=o.data.result;"DNI"==e?t.cliente.Cliente=a.Nombre+" "+a.Paterno+" "+a.Materno:(t.cliente.Cliente=a.RazonSocial,t.cliente.Direccion=a.Direccion)}else t.$toasted.show("No se encontró el Usuario")}).catch(function(e){t.$toasted.show("No se encontró el Usuario"),console.log(e)})},guardarCliente:function(t){var e=this;t.preventDefault(),this.axios.post(this.API+"clientes",this.cliente).then(function(t){e.$emit("onAddCliente",t.data),e.$toasted.show("Cliente guardado correctamente"),e.$refs.clienteForm.hide()}).catch(function(t){e.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})}}},G={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-btn",{attrs:{variant:"primary"},on:{click:function(e){t.show=!0}}},[t._v("Nuevo")]),t._v(" "),o("b-form",{ref:"form",on:{submit:t.guardarCliente}},[t.show?o("b-modal",{ref:"clienteForm",staticClass:"modal-cliente",attrs:{"no-close-on-backdrop":"",title:"Nuevo Cliente",size:"lg"},on:{shown:t.shownClienteForm},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("b-row",[o("b-col",{attrs:{md:"12"}},[o("b-form-group",[o("label",[t._v("DNI / RUC:")]),t._v(" "),o("b-input-group",[o("b-form-input",{attrs:{required:"required"},model:{value:t.cliente.DniRuc,callback:function(e){t.$set(t.cliente,"DniRuc",e)},expression:"cliente.DniRuc"}}),t._v(" "),o("b-input-group-append",[o("b-btn",{attrs:{variant:"info"},on:{click:t.consultarDNIRUC}},[t._v("Buscar ")])],1)],1)],1),t._v(" "),o("b-form-group",[o("label",[t._v("Nombre del Cliente:")]),t._v(" "),o("b-form-input",{attrs:{required:"required",type:"text"},model:{value:t.cliente.Cliente,callback:function(e){t.$set(t.cliente,"Cliente",e)},expression:"cliente.Cliente"}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Dirección:")]),t._v(" "),o("b-form-input",{attrs:{type:"text"},model:{value:t.cliente.Direccion,callback:function(e){t.$set(t.cliente,"Direccion",e)},expression:"cliente.Direccion"}})],1)],1)],1),t._v(" "),o("b-row",[o("b-col",[o("b-form-group",[o("label",[t._v("Teléfono:")]),t._v(" "),o("b-form-input",{attrs:{type:"text"},model:{value:t.cliente.Telefono,callback:function(e){t.$set(t.cliente,"Telefono",e)},expression:"cliente.Telefono"}})],1)],1),t._v(" "),o("b-col",[o("b-form-group",[o("label",[t._v("Correo Electrónico:")]),t._v(" "),o("b-form-input",{attrs:{type:"email"},model:{value:t.cliente.Email,callback:function(e){t.$set(t.cliente,"Email",e)},expression:"cliente.Email"}})],1)],1),t._v(" "),o("b-col",[o("b-form-group",[o("label",[t._v("Nacionalidad:")]),t._v(" "),o("b-form-input",{attrs:{type:"text"},model:{value:t.cliente.Nacionalidad,callback:function(e){t.$set(t.cliente,"Nacionalidad",e)},expression:"cliente.Nacionalidad"}})],1)],1)],1),t._v(" "),o("b-row",[o("b-col",[o("b-form-group",[o("label",[t._v("Sexo:")]),t._v(" "),o("b-form-select",{staticClass:"mb-3",attrs:{options:["M","F"]},model:{value:t.cliente.Sexo,callback:function(e){t.$set(t.cliente,"Sexo",e)},expression:"cliente.Sexo"}})],1)],1),t._v(" "),o("b-col",[o("b-form-group",[o("label",[t._v("Ocupación:")]),t._v(" "),o("b-form-input",{attrs:{type:"text"},model:{value:t.cliente.Ocupacion,callback:function(e){t.$set(t.cliente,"Ocupacion",e)},expression:"cliente.Ocupacion"}})],1)],1),t._v(" "),o("b-col",[o("b-form-group",[o("label",[t._v("Fecha Nacimiento:")]),t._v(" "),o("b-form-input",{attrs:{type:"date"},model:{value:t.cliente.FechaNacimiento,callback:function(e){t.$set(t.cliente,"FechaNacimiento",e)},expression:"cliente.FechaNacimiento"}})],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"modal-footer"},slot:"modal-footer"},[o("b-btn",{attrs:{variant:"primary",type:"submit"}},[t._v("\n         Guardar\n       ")]),t._v(" "),o("b-btn",{attrs:{variant:"secondary"},on:{click:function(e){t.show=!1}}},[t._v("\n         Close\n       ")])],1)],1):t._e()],1)],1)},staticRenderFns:[]};var K=o("VU/8")(L,G,!1,function(t){o("tI9C")},"data-v-f610954c",null).exports,X={mounted:function(){this.obtenerDescuento()},data:function(){return{API:v.a.API,show:!1,porCada:20,puntos:1,valorPunto:1}},methods:{obtenerDescuento:function(){var t=this;this.axios.get(this.API+"ventas/descuento").then(function(e){t.porCada=e.data.PorCada,t.puntos=e.data.Puntos,t.valorPunto=e.data.ValorPunto}).catch(function(e){console.log(e),t.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})},guardarConfigVenta:function(t){var e=this;t.preventDefault(),this.axios.post(this.API+"ventas/descuento",{porCada:this.porCada,puntos:this.puntos,valorPunto:this.valorPunto}).then(function(t){e.$emit("onUpdateConfig",t.data),e.obtenerDescuento(),e.$toasted.show("Se actualizó la configuración"),e.show=!1}).catch(function(t){console.log(t),e.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})}}},Z={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-button",{attrs:{variant:"outline-primary"},on:{click:function(e){t.show=!0}}},[t._v("Configurar")]),t._v(" "),o("b-form",{on:{submit:t.guardarConfigVenta}},[o("b-modal",{attrs:{id:"modalConfigVenta",title:"Configurar Venta",size:"md","header-bg-variant":"dark",headerTextVariant:"light","body-bg-variant":"light","body-text-variant":"dark"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("b-row",{staticClass:"mb-1"},[o("b-col",[o("label",{attrs:{for:"input-porcada"}},[t._v("Por la compra de:")])]),t._v(" "),o("b-col",[o("b-input-group",{attrs:{size:"sm",prepend:"S/. "}},[o("b-form-input",{attrs:{id:"input-porcada",type:"number",min:"0",step:"0.1",placeholder:""},model:{value:t.porCada,callback:function(e){t.porCada=e},expression:"porCada"}})],1)],1)],1),t._v(" "),o("b-row",{staticClass:"mb-1"},[o("b-col",[o("label",{attrs:{for:"input-porcada"}},[t._v("El cliente gana:")])]),t._v(" "),o("b-col",[o("b-input-group",{attrs:{size:"sm",append:"punto(s)"}},[o("b-form-input",{attrs:{id:"input-porcada",type:"number",min:"0",step:"1",placeholder:""},model:{value:t.puntos,callback:function(e){t.puntos=e},expression:"puntos"}})],1)],1)],1),t._v(" "),o("b-row",{staticClass:"mb-1"},[o("b-col",[o("label",{attrs:{for:"input-porcada"}},[t._v("Cada punto vale:")])]),t._v(" "),o("b-col",[o("b-input-group",{attrs:{size:"sm",prepend:"S/. "}},[o("b-form-input",{attrs:{id:"input-porcada",type:"number",min:"0",step:"0.1",placeholder:""},model:{value:t.valorPunto,callback:function(e){t.valorPunto=e},expression:"valorPunto"}})],1)],1)],1),t._v(" "),o("div",{attrs:{slot:"modal-footer"},slot:"modal-footer"},[o("b-btn",{attrs:{size:"sm",variant:"success",type:"submit"}},[t._v("\n                    Guardar\n                ")]),t._v(" "),o("b-btn",{attrs:{size:"sm",variant:"secondary"},on:{click:function(e){t.show=!1}}},[t._v("\n                    Cerrar\n                ")])],1)],1)],1)],1)},staticRenderFns:[]};var J=o("VU/8")(X,Z,!1,function(t){o("ROxG")},null,null).exports,Q={mounted:function(){var t=this;this.axios.get(this.API+"preorden/count").then(function(e){t.totalRows=e.data.total}),this.$route.query.idPreOrden&&this.$route.query.idCliente&&this.selectPreOrden({IdPreOrden:this.$route.query.idPreOrden,IdCliente:this.$route.query.idCliente})},data:function(){return{API:v.a.API,show:!1,filter:"",items:[],isBusy:!1,fields:["IdPreOrden","FechaReg","Cliente","DniRuc","imprimir"],totalRows:50,perPage:5,currentPage:1}},props:["idAlmacen"],methods:c()({},Object(d.b)({add:"agregarProducto",obtenerStok:"obtenerStock"}),{cargarPreOrden:function(){this.show=!0,this.$refs.tablaPreOrden.refresh()},selectPreOrden:function(t){var e=this;this.axios.get(this.API+"preorden/detalle",{params:{idPreOrden:t.IdPreOrden}}).then(function(o){o.data.map(function(t){e.add([t.IdProducto,function(){e.obtenerStok({IdAlmacen:e.idAlmacen})},{setPrecio:!0,cantidad:t.Cantidad}]),e.filter="",e.show=!1}),e.$emit("onPreOrden",t),e.$emit("onSelectPreOrden",t.IdCliente)})},myProvider:function(t){var e=this;return this.axios.get(this.API+"preorden?limit="+t.perPage+"&page="+t.currentPage+"&filter="+t.filter).then(function(t){return e.items=t.data,e.items}).catch(function(t){return[]})}})},W={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-button",{attrs:{variant:"outline-success"},on:{click:t.cargarPreOrden}},[t._v("Cargar Pre Orden")]),t._v(" "),o("b-form",[o("b-modal",{attrs:{id:"modalPreOrden",title:"Seleccionar Pre Orden",size:"lg","header-bg-variant":"dark",headerTextVariant:"light","body-bg-variant":"light","body-text-variant":"dark"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("b-form-input",{attrs:{placeholder:"Buscar"},on:{input:function(e){t.currentPage=1}},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),o("b-table",{ref:"tablaPreOrden",attrs:{id:"my-table",striped:"",hover:"",busy:t.isBusy,filter:t.filter,items:t.myProvider,fields:t.fields,"per-page":t.perPage,"current-page":t.currentPage},on:{"update:busy":function(e){t.isBusy=e},"row-clicked":t.selectPreOrden},scopedSlots:t._u([{key:"imprimir",fn:function(e){return[o("b-btn",{attrs:{size:"sm",variant:"success",target:"_blank",href:"/imprimir/preorden.php?id="+e.item.IdPreOrden}},[t._v("Imprimir")])]}}])}),t._v(" "),o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"6"}},[o("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1),t._v(" "),o("div",{attrs:{slot:"modal-footer"},slot:"modal-footer"},[o("b-btn",{attrs:{size:"sm",variant:"secondary"},on:{click:function(e){t.show=!1}}},[t._v("\n                    Cerrar\n                ")])],1)],1)],1)],1)},staticRenderFns:[]};var tt=o("VU/8")(Q,W,!1,function(t){o("Tfc3")},null,null).exports,et={beforeMount:function(){this.initForm()},mounted:function(){this.getNumeroVenta()},data:function(){return{dni:"",newDniRuc:"",ultimaVenta:"",inProgress:!1,API:v.a.API,puntosAplicados:0,descuentoPuntos:{},descuentoGeneral:0,tieneIgv:!1,venta:{},carrito:{fields:[{key:"stock",label:"Stock",variant:"info",class:"text-center"},{key:"Producto"},{key:"Descripcion",label:"Descripción"},{key:"FechaAlquiler",label:"Fecha Inicio"},{key:"FechaAlquilerFin",label:"Fecha Fin"},{key:"cantidad"},{key:"precio",label:"Precio"},{key:"subtotal",label:"SubTotal",variant:"success",class:"text-center"},{key:"descuento",label:"Descuento"},{key:"total",label:"Total",variant:"danger",class:"text-center"},{key:"acciones",label:""}]}}},watch:{totalCart:function(t){this.venta.pago.efectivo.monto=t-(parseFloat(this.venta.pago.visa.monto)+parseFloat(this.venta.pago.mastercard.monto))}},computed:c()({},Object(d.c)({productos:function(t){return t.cart.productos},totalCart:function(t){return t.cart.totalCart}})),methods:c()({},Object(d.b)({aplicarDescuento:"aplicarDescuentoGeneral",limpiarCart:"limpiarCarrito",obtenerStok:"obtenerStock"}),{selectPreOrden:function(t){this.venta.IdPreOrden.push(t)},loadFirstAlmacen:function(){var t=this;this.axios.get(this.API+"almacenes/primero").then(function(e){t.$refs.inputAlmacen.setValue(e.data.Almacen),t.venta.almacen=e.data})},loadClienteBarcode:function(t){t.preventDefault();var e=this.dni;e&&this.setCliente(!1,e)},focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()},initForm:function(){this.venta={EsCredito:0,Serie:"",Numero:"",cliente:{},tipoVenta:{IdTipoDoc:7,TipoDoc:"BOLETA ELEC.",LimitItems:0},almacen:{IdAlmacen:1,Almacen:"VENTA"},puntoVenta:{IdDocVentaPuntoVenta:1,PuntoVenta:"CAJA1"},vendedor:{},FechaCredito:this.$moment().format("YYYY-MM-DD"),FechaDoc:this.$moment().format("YYYY-MM-DDTH:mm:ss"),pago:{efectivo:{IdMetodoPago:1,monto:0},visa:{IdMetodoPago:2,monto:0},mastercard:{IdMetodoPago:3,monto:0}},IdPreOrden:[]}},setTipoVenta:function(t){t.TieneIgv?this.tieneIgv=!0:this.tieneIgv=!1,this.venta.tipoVenta=t,this.getNumeroVenta()},setAlmacen:function(t){this.venta.almacen=t,this.obtenerStok({IdAlmacen:this.venta.almacen.IdAlmacen})},setPuntoVenta:function(t){this.venta.puntoVenta=t,this.getNumeroVenta()},setVendedor:function(t){this.venta.vendedor=t},setCliente:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={};a=o?{dni:o}:{idCliente:t},"object"===(void 0===t?"undefined":H()(t))?(this.$refs.inputCliente.setValue(t.Cliente),this.venta.cliente=t):this.axios.get(this.API+"cliente",{params:a}).then(function(t){t.data?(e.$refs.inputCliente.setValue(t.data.Cliente),e.venta.cliente=t.data):e.$toasted.show("No se encontro al cliente")}).catch(function(t){console.log(t)})},onSetProducto:function(t){return t.cantidad=1,t.precio=t.PrecioContado||0,t},onAddProducto:function(t){this.actualizarDescuento(),this.obtenerStok({IdAlmacen:this.venta.almacen.IdAlmacen})},actualizarDescuento:function(){this.puntosAplicados>0&&this.aplicarPuntos(this.puntosAplicados),this.descuentoGeneral>0&&this.aplicarDescuentoGeneral(this.descuentoGeneral)},aplicarPuntos:function(t){var e=this;parseFloat(t)>this.venta.cliente.Puntos&&(this.puntosAplicados=this.venta.cliente.Puntos),this.axios.get(this.API+"ventas/descuento/"+this.puntosAplicados).then(function(t){e.descuentoPuntos=t.data,e.aplicarDescuento(t.data.descuento)}).catch(function(t){console.log(t),e.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})},aplicarDescuentoGeneral:function(t){this.puntosAplicados=0,this.aplicarDescuento(t)},getNumeroVenta:function(){var t=this;this.axios.get(this.API+"ventas/numero",{params:{idPuntoVenta:this.venta.puntoVenta.IdDocVentaPuntoVenta,idTipoDoc:this.venta.tipoVenta.IdTipoDoc}}).then(function(e){t.venta.Serie=e.data.serie,t.venta.Numero=e.data.numero}).catch(function(e){console.log(e),t.$toasted.show("Ha ocurrido un error, vuelva a intentarlo")})},updateTime:function(){this.venta.FechaDoc=this.$moment().format("YYYY-MM-DDTH:mm:ss")},guardarVenta:function(t){var e=this;t.preventDefault(),this.inProgress=!0;var o=0;return o+=parseFloat(this.venta.pago.efectivo.monto),o+=parseFloat(this.venta.pago.visa.monto),o+=parseFloat(this.venta.pago.mastercard.monto),this.venta.EsCredito||this.totalCart==o?this.productos.length?this.totalCart<=0?(this.$toasted.show("La venta en S/. 0.00 no está permitido"),void(this.inProgress=!1)):(this.venta.productos=this.productos,this.venta.puntosAplicados=this.puntosAplicados||0,this.venta.totalCart=this.totalCart||0,this.venta.PagoCon=this.$refs.carrito.pagocon,void this.axios.post(this.API+"ventas",this.venta).then(function(t){e.$router.replace("/ventas"),e.$toasted.show("Venta realizada con exito"),e.inProgress=!1,e.tieneIgv=!1,e.ultimaVenta=t.data.insertId,e.initForm(),e.limpiarCart(),e.getNumeroVenta(),e.$refs.inputTipoVenta.setValue("BOLETA ELEC."),e.$refs.inputAlmacen.setValue("VENTA"),e.$refs.inputPuntoVenta.setValue("CAJA1"),e.$refs.inputCliente.setValue(""),e.$refs.inputVendedor.setValue(""),window.open("/imprimir/index.php?IdDocVenta="+t.data.insertId,"_blank")}).catch(function(t){console.log(t),e.$toasted.show("Ha ocurrido un error, vuelva a intentarlo"),e.inProgress=!1})):(this.$toasted.show("No hay productos para vender"),void(this.inProgress=!1)):(this.$toasted.show("Los pagos no coinciden con la venta"),void(this.inProgress=!1))},eliminarCliente:function(){this.$refs.inputCliente.setValue(""),this.venta.cliente={}}}),components:{ProductosCarrito:y,ClientesForm:K,ConfigVenta:J,PreOrdenLista:tt}},ot={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t._e(),t._v(" "),o("br"),t._v(" "),o("b-container",{staticClass:"bv-example-row"},[o("div",[o("div",{staticClass:"float-right"},[o("b-button-group",{attrs:{size:"sm"}},[o("pre-orden-lista",{directives:[{name:"show",rawName:"v-show",value:!this.$route.query.idPreOrden,expression:"!this.$route.query.idPreOrden"}],attrs:{idAlmacen:t.venta.almacen.IdAlmacen},on:{onSelectPreOrden:t.setCliente,onPreOrden:t.selectPreOrden}})],1),t._v(" "),o("b-button-group",{attrs:{size:"sm"}},[o("config-venta",{on:{onUpdateConfig:t.eliminarCliente}})],1)],1)]),t._v(" "),o("br"),o("br"),t._v(" "),o("b-form",{on:{submit:t.guardarVenta,keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?e.preventDefault():null}}},[o("b-row",[o("b-col",{attrs:{md:"7"}},[o("b-row",[o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Tipo de Venta:")]),t._v(" "),o("autocomplete",{ref:"inputTipoVenta",attrs:{required:"required",url:t.API+"ventas/tipos",anchor:"TipoDoc",initValue:"BOLETA ELEC.",label:"writer",placeholder:"","on-select":t.setTipoVenta,onFocus:t.focusAutocomplete.bind(null,"inputTipoVenta"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Almacen:")]),t._v(" "),o("autocomplete",{ref:"inputAlmacen",attrs:{required:"required",url:t.API+"almacenes",anchor:"Almacen",initValue:"VENTA",label:"writer",placeholder:"","on-select":t.setAlmacen,onFocus:t.focusAutocomplete.bind(null,"inputAlmacen"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Punto de Venta:")]),t._v(" "),o("autocomplete",{ref:"inputPuntoVenta",attrs:{required:"required",url:t.API+"ventas/puntos",anchor:"PuntoVenta",initValue:"CAJA1",label:"writer",placeholder:"","on-select":t.setPuntoVenta,onFocus:t.focusAutocomplete.bind(null,"inputPuntoVenta"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"12"}},[o("b-form-group",[o("label",[t._v("Cliente:")]),t._v(" "),o("b-input-group",[o("autocomplete",{ref:"inputCliente",attrs:{required:"required",url:t.API+"clientes",anchor:"ClienteDniRuc",label:"writer",placeholder:"",onInput:function(e){return t.newDniRuc=e},"on-select":t.setCliente,onFocus:t.focusAutocomplete.bind(null,"inputCliente"),classes:{input:"form-control"}}}),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.dni,expression:"dni"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Codigo de Barra"},domProps:{value:t.dni},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?(e.preventDefault(),t.loadClienteBarcode(e)):null},input:function(e){e.target.composing||(t.dni=e.target.value)}}}),t._v(" "),o("b-input-group-append",[o("clientes-form",{attrs:{ruc:t.newDniRuc},on:{onAddCliente:t.setCliente}})],1)],1)],1)],1)],1)],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[t.venta.cliente.Cliente?o("b-form-group",{staticClass:"text-center"},[o("div",{staticClass:"puntos"},[t._v("\n                            "+t._s(t._f("redondeoMenor")(t.venta.cliente.Puntos||0))+"\n                        ")]),t._v("\n                        Puntos del cliente\n                    ")]):t._e(),t._v(" "),t.venta.cliente.Puntos&&0==t.descuentoGeneral?o("b-input-group",{attrs:{prepend:"Puntos",append:t._f("redondear")(t.descuentoPuntos.descuento)}},[o("b-form-input",{attrs:{min:"0",max:t.venta.cliente.Puntos,type:"number"},on:{input:t.aplicarPuntos},model:{value:t.puntosAplicados,callback:function(e){t.puntosAplicados=e},expression:"puntosAplicados"}})],1):t._e(),t._v(" "),t.descuentoPuntos.ValorPunto?o("b-form-text",[t._v("\n                       1 Punto equivale a: S/ "+t._s(t._f("redondear")(t.descuentoPuntos.ValorPunto))+"\n                    ")]):t._e()],1),t._v(" "),o("b-col",{attrs:{md:"2"}},[o("b-form-group",{staticClass:"text-center"},[o("div",{staticClass:"big-text"},[t._v("\n                            "+t._s(t.venta.Serie)+" - "),o("b",[t._v(t._s(t.venta.Numero))])]),t._v("\n                        "+t._s(t.venta.FechaDoc)+"\n                    ")]),t._v(" "),o("b-form-group",[o("label",[t._v("Vendedor:")]),t._v(" "),o("autocomplete",{ref:"inputVendedor",attrs:{required:"required",url:t.API+"usuarios",anchor:"NombreUsuario",label:"writer","on-select":t.setVendedor,onFocus:t.focusAutocomplete.bind(null,"inputVendedor"),classes:{input:"form-control"}}})],1)],1)],1),t._v(" "),o("b-row",[o("b-col",[o("productos-carrito",{ref:"carrito",attrs:{igvTotal:t.tieneIgv,setPrecio:!0,showButton:!1,fields:t.carrito.fields,onSetProducto:t.onSetProducto},on:{onInputCantidad:t.actualizarDescuento,onAddProducto:t.onAddProducto,onRemoveProducto:t.actualizarDescuento}},[o("template",{slot:"operaciones"},[o("table",{staticClass:"table b-table border table-footer"},[o("tbody",[o("tr",[o("td",{staticClass:"text-center"},[t._v("Opciones")])]),t._v(" "),0==t.puntosAplicados?o("tr",[o("td",[o("b-input-group",{attrs:{prepend:"S/",append:"Descuento"}},[o("b-form-input",{attrs:{min:"0",value:"0",type:"number"},on:{input:t.aplicarDescuentoGeneral},model:{value:t.descuentoGeneral,callback:function(e){t.descuentoGeneral=e},expression:"descuentoGeneral"}})],1),t._v(" "),o("b-form-text",[t._v("\n                                                Descuento general a toda la venta.\n                                            ")])],1)]):t._e(),t._v(" "),o("tr",[o("td",[o("b-form-checkbox",{attrs:{id:"checkbox1",value:1,"unchecked-value":0},model:{value:t.venta.EsCredito,callback:function(e){t.$set(t.venta,"EsCredito",e)},expression:"venta.EsCredito"}},[t._v("\n                                                Venta a credito\n                                            ")]),t._v(" "),t.venta.EsCredito?o("b-form-input",{attrs:{type:"date"},model:{value:t.venta.FechaCredito,callback:function(e){t.$set(t.venta,"FechaCredito",e)},expression:"venta.FechaCredito"}}):t._e()],1)])])])]),t._v(" "),t.venta.EsCredito?t._e():o("template",{slot:"metodopago"},[o("table",{staticClass:"table b-table border table-footer table-sm"},[o("tbody",[o("tr",[o("td",{staticClass:"text-center",attrs:{colspan:"3"}},[t._v("Metodo de Pago")])]),t._v(" "),o("tr",[o("td",[t._v("Efectivo")]),t._v(" "),o("td",[o("b-form-input",{attrs:{type:"text",placeholder:"Descripcion"},model:{value:t.venta.pago.efectivo.descripcion,callback:function(e){t.$set(t.venta.pago.efectivo,"descripcion",e)},expression:"venta.pago.efectivo.descripcion"}})],1),t._v(" "),o("td",[o("b-form-input",{attrs:{min:"0",step:"0.01",type:"number",placeholder:"S/."},model:{value:t.venta.pago.efectivo.monto,callback:function(e){t.$set(t.venta.pago.efectivo,"monto",e)},expression:"venta.pago.efectivo.monto"}})],1)]),t._v(" "),o("tr",[o("td",[t._v("Visa")]),t._v(" "),o("td",[o("b-form-input",{attrs:{type:"text",placeholder:"Descripcion"},model:{value:t.venta.pago.visa.descripcion,callback:function(e){t.$set(t.venta.pago.visa,"descripcion",e)},expression:"venta.pago.visa.descripcion"}})],1),t._v(" "),o("td",[o("input",{directives:[{name:"model",rawName:"v-model",value:t.venta.pago.visa.monto,expression:"venta.pago.visa.monto"}],staticClass:"form-control",attrs:{min:"0",step:"0.01",type:"number",placeholder:"S/."},domProps:{value:t.venta.pago.visa.monto},on:{input:[function(e){e.target.composing||t.$set(t.venta.pago.visa,"monto",e.target.value)},function(e){t.venta.pago.efectivo.monto=t.$options.filters.redondear(t.totalCart-t.venta.pago.mastercard.monto-e.target.value)}]}})])]),t._v(" "),o("tr",[o("td",[t._v("Mastercard")]),t._v(" "),o("td",[o("b-form-input",{attrs:{type:"text",placeholder:"Descripcion"},model:{value:t.venta.pago.mastercard.descripcion,callback:function(e){t.$set(t.venta.pago.mastercard,"descripcion",e)},expression:"venta.pago.mastercard.descripcion"}})],1),t._v(" "),o("td",[o("input",{directives:[{name:"model",rawName:"v-model",value:t.venta.pago.mastercard.monto,expression:"venta.pago.mastercard.monto"}],staticClass:"form-control",attrs:{min:"0",step:"0.01",type:"number",placeholder:"S/."},domProps:{value:t.venta.pago.mastercard.monto},on:{input:[function(e){e.target.composing||t.$set(t.venta.pago.mastercard,"monto",e.target.value)},function(e){t.venta.pago.efectivo.monto=t.$options.filters.redondear(t.totalCart-t.venta.pago.visa.monto-e.target.value)}]}})])])])])])],2)],1)],1),t._v(" "),o("b-row",{staticClass:"text-center",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"8"}},[o("br"),t._v(" "),o("b-button",{attrs:{type:"submit",disabled:t.inProgress,variant:"success",size:"lg"}},[t._v("Efectuar Venta")]),t._v(" "),t.ultimaVenta?o("b-button",{attrs:{target:"_blank",variant:"info",size:"lg",href:"/imprimir/index.php?IdDocVenta="+t.ultimaVenta}},[t._v("Imprimir última Venta")]):t._e(),t._v(" "),o("br"),t._v(" "),o("br")],1)],1)],1)],1)],1)},staticRenderFns:[]};var at=o("VU/8")(et,ot,!1,function(t){o("zuH2")},"data-v-f7e2c430",null).exports,rt=o("BO1k"),nt=o.n(rt),it=o("Xxa5"),st=o.n(it),ct=o("//Fk"),lt=o.n(ct),ut=o("exGp"),dt=o.n(ut),pt=o("mvHQ"),vt=o.n(pt),mt=o("woOf"),ht=o.n(mt),ft={mounted:function(){var t=this;this.axios.get(this.API+"ventas/count",{params:{idAlmacen:this.almacen.IdAlmacen}}).then(function(e){t.totalRows=e.data.total}),this.getVentasAcumuladas(),this.loadFirstAlmacen()},data:function(){return{API:v.a.API,imgCaptcha:!0,captcha:"",loading:!1,tipoDoc:{IdTipoDoc:1,CodSunat:"01"},estadoVenta:1,optionsEstado:[{value:"1",text:"PENDIENTE"},{value:"2",text:"EMITIDOS"},{value:"0",text:"ANULADOS"}],vendedor:"",fechaInicio:this.$moment().format("YYYY-MM-DD"),fechaFin:this.$moment().format("YYYY-MM-DD"),fechaReferencia:this.$moment().format("YYYY-MM-DD"),filters:{},filter:"",sortBy:"FechaDoc",sortDesc:!1,ventasAcumuladas:0,almacen:{IdAlmacen:1},pageOptions:[5,10,15,50,100],ventaSelect:{},ventaDetalleSelect:[],items:[],itemsDetalle:[],showVenta:!1,isBusy:!1,fields:[{key:"detalles",label:""},{key:"idDocVenta",label:"ID",sortable:!0},{key:"FechaDoc",label:"Fecha",sortable:!0},{key:"TipoDoc",label:"Documento",sortable:!0},{key:"Serie",label:"Serie",sortable:!0},{key:"Numero",sortable:!0},{key:"Cliente",sortable:!0},{key:"Anulado",label:"Anulado",sortable:!0},{key:"UsuarioReg",label:"Vendedor",sortable:!0},{key:"Total",sortable:!1,variant:"success",class:"text-center"},{key:"estado",sortable:!1,class:"text-center"},{key:"consulta",class:"text-center"}],totalRows:50,perPage:10,currentPage:1,itemsStatus:{},isBoleta:!1,itemsMotivoNota:[{value:null,text:"-- SELECCIONE EL MOTIVO --"},{value:"01",text:"ANULACION DE LA OPERACION"},{value:"02",text:"ANULACION POR ERROR EN EL RUC"}],notaIdMotivo:null,notaCredito:{}}},watch:{estadoVenta:function(t){},items:function(t){var e=this;t.length&&this.axios.get(this.API+"ventas/detalle",{params:{idDocVentas:t.map(function(t){return t.idDocVenta})}}).then(function(t){e.itemsDetalle=t.data,e.items.map(function(t){return t.productos=e.getDetalles(t.idDocVenta),t})}).catch(function(t){console.log(t)})}},computed:{},methods:{loadFirstAlmacen:function(t){var e=this;this.axios.get(this.API+"almacenes/primero").then(function(t){e.$refs.inputAlmacen.setValue(t.data.Almacen),e.setAlmacen(t.data)})},setFechaReferencia:function(t){this.fechaInicio=t,this.fechaFin=t},setTipoDoc:function(t){var e=this;console.log(t),this.tipoDoc=t,3==this.tipoDoc.CodSunat?(this.isBoleta=!0,this.fechaInicio=this.fechaReferencia,this.fechaFin=this.fechaReferencia):this.isBoleta=!1,Vue.nextTick(function(){e.$refs.tablaVentas.refresh()})},getStatus:function(t){var e=this.itemsStatus[t]||{};return e.Estado&&(e.image=2==e.Estado?"success.png":"error.png"),e},emitirNotaCredito:function(t){var e=this,o=ht()({},t);this.loading=!0,o.codSunatModifica=o.CodSunat,o.nroComprobanteModifica=o.Serie+"-"+o.Numero,o.notaIdMotivo=this.notaIdMotivo,o.notaDescMotivo=this.itemsMotivoNota.filter(function(t){return t.value==e.notaIdMotivo})[0].text,o.CodSunat="07",o.Serie=this.notaCredito.serie,o.Numero=this.notaCredito.numero,console.log(vt()(o)),this.axios.post(this.API+"emitirelectronico",{docVenta:o}).then(function(t){console.log(t),e.$toasted.success(t.data.msj_sunat,{duration:7e3}),e.notaIdMotivo=null,e.loading=!1})},emitirElectronico:function(t){var e=this;return dt()(st.a.mark(function t(){var o,a,r,n,i,s,c,l;return st.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.items.length){t.next=3;break}return e.$toasted.show("No hay documentos para emitir"),t.abrupt("return");case 3:if(e.loading=!0,o=[],"01"!=e.tipoDoc.CodSunat&&"03"!=e.tipoDoc.CodSunat){t.next=33;break}a=st.a.mark(function t(a){return st.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(1!=a.Estado){t.next=7;break}return console.log(vt()(a)),t.t0=o,t.next=5,e.axios.post(e.API+"emitirelectronico",{docVenta:a}).then(function(t){if(console.log(t),1==t.data.Estado)e.$toasted.error(t.data.msj_sunat);else{e.$toasted.success(t.data.msj_sunat),Vue.set(e,"items",e.items.filter(function(t){return t.idDocVenta!==a.idDocVenta}));t.data.data.txtNRO_COMPROBANTE.split("-")[0],t.data.data.txtNRO_COMPROBANTE.split("-")[1]}Vue.set(e.itemsStatus,a.idDocVenta,t.data)});case 5:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 7:case"end":return t.stop()}},t,e)}),r=!0,n=!1,i=void 0,t.prev=10,s=nt()(e.items);case 12:if(r=(c=s.next()).done){t.next=18;break}return l=c.value,t.delegateYield(a(l),"t0",15);case 15:r=!0,t.next=12;break;case 18:t.next=24;break;case 20:t.prev=20,t.t1=t.catch(10),n=!0,i=t.t1;case 24:t.prev=24,t.prev=25,!r&&s.return&&s.return();case 27:if(t.prev=27,!n){t.next=30;break}throw i;case 30:return t.finish(27);case 31:return t.finish(24);case 32:lt.a.all(o).then(function(t){e.loading=!1});case 33:e.tipoDoc.CodSunat;case 34:case"end":return t.stop()}},t,e,[[10,20,24,32],[25,,27,31]])}))()},emitirElectronicoResumen:function(t){var e=this;return dt()(st.a.mark(function t(){return st.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.items.length){t.next=3;break}return e.$toasted.show("No hay documentos para emitir"),t.abrupt("return");case 3:e.loading=!0,"03"==e.tipoDoc.CodSunat&&e.axios.post(e.API+"emitirelectronicoboleta",{boletas:e.items,fechaReferencia:e.fechaReferencia,codSunat:e.tipoDoc.CodSunat}).then(function(t){console.log(t.data),e.items.forEach(function(o){Vue.set(e.itemsStatus,o.idDocVenta,t.data)}),e.loading=!1});case 5:case"end":return t.stop()}},t,e)}))()},eliminarElectronico:function(t){var e=this;if(1==confirm("¿Desea Anular la venta?")){if(this.loading=!0,"01"==this.tipoDoc.CodSunat){var o=prompt("Escriba el motivo por el cual desea dar de baja esta factura");o&&this.axios.post(this.API+"bajaelectronico",{facturas:[t],descripcion:o,codSunat:this.tipoDoc.CodSunat}).then(function(t){console.log(t),e.$toasted.show("Factura Anulada"),e.$refs.tablaVentas.refresh(),e.loading=!1})}"03"==this.tipoDoc.CodSunat&&this.axios.post(this.API+"emitirelectronicoboleta",{boletas:[t],statu:3,codSunat:this.tipoDoc.CodSunat,fechaReferencia:this.fechaReferencia}).then(function(t){console.log(t),e.$toasted.show("Boleta Anulada"),e.$refs.tablaVentas.refresh(),e.loading=!1})}},getDetalles:function(t){return this.itemsDetalle.filter(function(e){return e.IdDocVenta==t})},getVentasAcumuladas:function(){var t=this;this.filters.vendedor?this.axios.get(this.API+"ventas/usuario",{params:{usuario:this.vendedor.Usuario,fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(function(e){t.ventasAcumuladas=e.data.total}):this.axios.get(this.API+"ventas/total",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin}}).then(function(e){t.ventasAcumuladas=e.data.total})},focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()},setAlmacen:function(t){var e=this;this.almacen=t,this.limpiarFiltros(),Vue.nextTick(function(){return e.$refs.tablaVentas.refresh()})},actualizarTabla:function(){this.$refs.tablaVentas.refresh()},myProvider:function(t){var e=this,o=this.API+"ventas?estado="+this.estadoVenta+"&idTipoDoc[]="+this.tipoDoc.IdTipoDoc+"&idAlmacen="+this.almacen.IdAlmacen+"&filter="+(t.filter||"")+"&sortBy="+t.sortBy;return o+="&sortDesc="+(t.sortDesc?1:0),console.log(o),this.axios.get(o).then(function(t){return e.items=t.data.map(function(t){return 1===t.Anulado&&(t._rowVariant="warning"),t}),e.items}).catch(function(t){return[]})},limpiarFiltros:function(){this.filters={},this.filter="",this.fechaInicio=this.$moment().format("YYYY-MM-DD"),this.fechaFin=this.$moment().format("YYYY-MM-DD")},generateFilter:function(t,e){this.filters[t]=e;var o="";for(var t in this.filters)o+="&filter["+t+"]="+this.filters[t];this.filter=o,this.getVentasAcumuladas()},exportarProductos:function(){},moverAEmitidos:function(t){var e=this;this.loading=!0,this.axios.post(this.API+"moveraemitidos",{idDocVenta:t.idDocVenta}).then(function(t){e.$refs.tablaVentas.refresh(),e.loading=!1})},consultaElectronico:function(t){var e=this;console.log(t);var o="",a="",r=this.$moment(t.FechaDoc,"YYYY-MM-DD hh:mm:ss").format("DD/MM/YYYY");console.log(r),"03"==t.CodSunat&&(o="06"),"01"==t.CodSunat&&(a=t.Total,o="03"),this.imgCaptcha=!1,window.open("http://www.sunat.gob.pe/ol-ti-itconsvalicpe/ConsValiCpe.htm?accion=CapturaCriterioValidez&num_ruc=20393999463&tipocomprobante="+o+"&num_serie="+t.Serie+"&num_comprob="+t.Numero+"&fec_emision="+encodeURI(r)+"&codigo="+this.captcha+(a?"&cantidad="+a:"")),setTimeout(function(){e.imgCaptcha=!0,e.captcha=""},1e3)}},components:{ProductoKardex:B}},bt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-container",{staticClass:"bv-example-row"},[o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"12"}},[o("b-row",[o("b-col",{attrs:{md:"2"}},[o("b-form-group",[o("label",[t._v("Almacen:")]),t._v(" "),o("autocomplete",{ref:"inputAlmacen",attrs:{required:"required",url:t.API+"almacenes",anchor:"Almacen",initValue:"",label:"writer",placeholder:"","on-select":t.setAlmacen,onFocus:t.focusAutocomplete.bind(null,"inputAlmacen"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("b-form-group",{directives:[{name:"show",rawName:"v-show",value:t.isBoleta,expression:"isBoleta"}]},[o("label",[t._v("Fecha Referencia:")]),t._v(" "),o("b-form-input",{attrs:{type:"date",placeholder:""},on:{input:t.setFechaReferencia},model:{value:t.fechaReferencia,callback:function(e){t.fechaReferencia=e},expression:"fechaReferencia"}})],1),t._v(" "),o("b-form-group",{directives:[{name:"show",rawName:"v-show",value:!t.isBoleta,expression:"!isBoleta"}]},[o("label",[t._v("Fecha Inicio:")]),t._v(" "),o("b-form-input",{attrs:{type:"date",placeholder:""},on:{input:function(e){return t.generateFilter("fechaInicio",e)}},model:{value:t.fechaInicio,callback:function(e){t.fechaInicio=e},expression:"fechaInicio"}})],1),t._v(" "),o("b-form-group",{directives:[{name:"show",rawName:"v-show",value:!t.isBoleta,expression:"!isBoleta"}]},[o("label",[t._v("Fecha Fin:")]),t._v(" "),o("b-form-input",{attrs:{type:"date",placeholder:""},on:{input:function(e){return t.generateFilter("fechaFin",e)}},model:{value:t.fechaFin,callback:function(e){t.fechaFin=e},expression:"fechaFin"}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Tipo Comprobante:")]),t._v(" "),o("autocomplete",{ref:"inputTipoVenta",attrs:{required:"required",url:t.API+"ventas/tipos/electronicos",initValue:"",anchor:"TipoDoc",label:"writer",placeholder:"","on-select":t.setTipoDoc,onFocus:t.focusAutocomplete.bind(null,"inputTipoVenta"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"2"}},[o("b-form-group",{attrs:{label:"Estado"}},[o("b-form-select",{attrs:{options:t.optionsEstado},on:{input:function(e){t.$refs.tablaVentas.refresh()}},model:{value:t.estadoVenta,callback:function(e){t.estadoVenta=e},expression:"estadoVenta"}})],1),t._v(" "),o("br")],1)],1)],1)],1),t._v(" "),o("b-row",[o("b-col",{attrs:{md:"12"}},[o("b-table",{ref:"tablaVentas",attrs:{small:"",filter:t.filter,"sort-by":t.sortBy,"sort-desc":t.sortDesc,striped:"",hover:"",id:"tabla-ventas",busy:t.isBusy,items:t.myProvider,fields:t.fields,"per-page":t.perPage,"current-page":t.currentPage},on:{"update:sortBy":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:busy":function(e){t.isBusy=e}},scopedSlots:t._u([{key:"detalles",fn:function(e){return[o("b-button",{staticClass:"mr-2",attrs:{size:"sm"},on:{click:function(t){return t.stopPropagation(),e.toggleDetails(t)}}},[t._v("\n                  "+t._s(e.detailsShowing?"-":"+")+"\n                ")])]}},{key:"row-details",fn:function(e){return[o("b-card",[o("b-row",{staticClass:"mb-2"},[o("table",{staticClass:"table b-table table-sm prod-detalle"},[o("thead",[o("tr",[o("th",[t._v("Codigo")]),t._v(" "),o("th",[t._v("Producto")]),t._v(" "),o("th",[t._v("Cantidad")]),t._v(" "),o("th",[t._v("Precio")]),t._v(" "),o("th",[t._v("Descuento")]),t._v(" "),e.item.TieneIgv?o("th",[t._v("Subtotal")]):t._e(),t._v(" "),e.item.TieneIgv?o("th",[t._v("IGV")]):t._e(),t._v(" "),o("th",[t._v("Total")])])]),t._v(" "),o("tbody",t._l(t.getDetalles(e.item.idDocVenta),function(a,r){return o("tr",{key:r},[o("td",[t._v(t._s(a.CodigoBarra))]),t._v(" "),o("td",[t._v(t._s(a.Producto))]),t._v(" "),o("td",[t._v(t._s(a.Cantidad))]),t._v(" "),o("td",[t._v(t._s(a.Precio))]),t._v(" "),o("td",[t._v(t._s(a.Descuento))]),t._v(" "),e.item.TieneIgv?o("td",[t._v("\n                        "+t._s(t._f("redondear")(a.Subtotal/1.18))+"                          \n                      ")]):t._e(),t._v(" "),e.item.TieneIgv?o("td",[t._v("\n                        "+t._s(t._f("redondear")(a.Subtotal-a.Subtotal/1.18))+"\n                      ")]):t._e(),t._v(" "),o("td",[t._v(t._s(t._f("redondear")(a.Subtotal)))])])}))]),t._v(" "),o("b-button",{staticStyle:{"margin-left":"30px"},attrs:{variant:"primary",size:"sm"},on:{click:function(o){t.moverAEmitidos(e.item)}}},[t._v("Mover a emitidos")])],1)],1)]}},{key:"estado",fn:function(e){return[o("div",{staticStyle:{display:"flex"}},[t.getStatus(e.item.idDocVenta).image&&2!=t.estadoVenta?o("img",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:t.getStatus(e.item.idDocVenta).msj_sunat,placement:"right",src:"static/"+t.getStatus(e.item.idDocVenta).image,width:"32",height:"32"}}):t._e(),t._v(" "),2==e.item.Estado?o("img",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],ref:"imgSuccess",attrs:{title:e.item.Msj_sunat,src:"static/success.png",width:"32",height:"32"}}):t._e(),t._v("\n                      \n                    "),0==t.estadoVenta?o("img",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:e.item.Msj_sunat+"\nDocumento Anulado",src:"static/cancel.png",height:"32"}}):t._e(),t._v(" "),2==t.estadoVenta?o("b-button",{attrs:{disabled:t.loading,variant:"danger",size:"sm"},on:{click:function(o){t.eliminarElectronico(e.item)}}},[t._v("Anular")]):t._e(),t._v("\n                    \n                      \n\n                    "),2==t.estadoVenta&&"01"==t.tipoDoc.CodSunat?o("b-button",{attrs:{id:"popover-nota"+e.index,disabled:t.loading,variant:"primary",size:"sm"}},[t._v("Nota Credito")]):t._e(),t._v(" "),2==t.estadoVenta&&"01"==t.tipoDoc.CodSunat?o("b-popover",{attrs:{target:"popover-nota"+e.index,title:"Emitir Nota Credito",placement:"top"}},[o("form",{on:{submit:function(o){o.preventDefault(),t.emitirNotaCredito(e.item)}}},[o("b-form-select",{staticClass:"mb-3",attrs:{options:t.itemsMotivoNota,size:"sm",required:""},model:{value:t.notaIdMotivo,callback:function(e){t.notaIdMotivo=e},expression:"notaIdMotivo"}}),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.notaCredito.serie,expression:"notaCredito.serie"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Serie",required:""},domProps:{value:t.notaCredito.serie},on:{input:function(e){e.target.composing||t.$set(t.notaCredito,"serie",e.target.value)}}}),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.notaCredito.numero,expression:"notaCredito.numero"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Numero",required:""},domProps:{value:t.notaCredito.numero},on:{input:function(e){e.target.composing||t.$set(t.notaCredito,"numero",e.target.value)}}}),t._v(" "),o("b-button",{attrs:{type:"submit",variant:"primary",size:"sm",disabled:t.loading}},[t._v("Emitir")])],1)]):t._e()],1)]}},{key:"consulta",fn:function(e){return[o("div",[o("div",{staticStyle:{width:"150px"}},[t.imgCaptcha?o("img",{staticStyle:{width:"80px",float:"left"},attrs:{id:"captcha",src:"http://www.sunat.gob.pe/ol-ti-itconsvalicpe/captcha?accion=image&nmagic=0"}}):t._e(),t._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.captcha,expression:"captcha"}],staticClass:"form-control",staticStyle:{width:"60px"},attrs:{type:"text"},domProps:{value:t.captcha},on:{input:function(e){e.target.composing||(t.captcha=e.target.value)}}})]),t._v(" "),o("b-button",{attrs:{disabled:t.loading,variant:"warning",size:"sm"},on:{click:function(o){t.consultaElectronico(e.item)}}},[t._v("Consulta SUNAT")])],1)]}}])})],1)],1),t._v(" "),o("br"),t._v(" "),o("b-row",{staticClass:"text-center",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"12"}},[1==t.estadoVenta&&"03"==t.tipoDoc.CodSunat?o("b-button",{attrs:{disabled:this.loading,variant:"warning",size:"lg"},on:{click:t.emitirElectronicoResumen}},[t._v("Emitir Como Resumen Diario")]):t._e(),t._v(" "),1==t.estadoVenta?o("b-button",{attrs:{disabled:this.loading,variant:"success",size:"lg"},on:{click:t.emitirElectronico}},[t._v("Emitir Documentos Electronicas")]):t._e()],1)],1),t._v(" "),o("br"),o("br")],1),t._v(" "),o("b-modal",{attrs:{id:"kardex",size:"lg","modal-class":"modal-xl",title:"Kardex de producto"},model:{value:t.showVenta,callback:function(e){t.showVenta=e},expression:"showVenta"}},[o("b-alert",{attrs:{show:"",variant:"warning"}},[t._v("titulo")])],1)],1)},staticRenderFns:[]};var _t=o("VU/8")(ft,bt,!1,function(t){o("zCoZ")},null,null).exports,gt={mounted:function(){this.getProductos()},data:function(){return{API:v.a.API,productos:[]}},props:["idPreorden","idProducto"],methods:{emitUpdate:function(){this.$emit("onUpdateProductos",this.productos)},getProductos:function(){var t=this;this.idPreorden&&this.axios.get(this.API+"preorden/detalle",{params:{idPreOrden:this.idPreorden}}).then(function(e){t.productos=e.data.map(function(e){return e.IdProducto===t.idProducto&&(e.isDisabled=!0),e})}).catch(function(t){console.log(t)})},renderChild:function(t){return"\n        <b>"+t.IdProducto+" - "+t.Producto+" - "+t.CodigoBarra+"</b>\n      "},addProducto:function(t){this.productos.findIndex(function(e){return e.IdProducto==t.IdProducto})>=0?this.$toasted.show("El producto ya está agregado"):t.EsHabitacion?this.$toasted.show("No puede ingresar este producto"):(this.productos.push(t),this.emitUpdate())},quitarProducto:function(t){var e=this.productos.findIndex(function(e){return e.IdProducto==t.IdProducto});this.productos.splice(e,1),this.emitUpdate()},focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()}}},Pt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-form-group",[o("label",[t._v("Agrega Productos:")]),t._v(" "),o("b-input-group",[o("autocomplete",{ref:"inputProducto",attrs:{url:t.API+"productos",anchor:"Producto",onShouldRenderChild:t.renderChild,label:"writer",placeholder:"Seleccionar Producto","on-select":t.addProducto,onFocus:t.focusAutocomplete.bind(null,"inputProducto"),classes:{input:"form-control upper"}}})],1)],1),t._v(" "),o("table",{staticClass:"table b-table table-sm"},[t._m(0),t._v(" "),o("tbody",t._l(t.productos,function(e,a){return o("tr",{key:a,class:{"bg-secondary text-white":e.isDisabled}},[o("td",[t._v(t._s(e.IdProducto))]),t._v(" "),o("td",[t._v(t._s(e.Producto))]),t._v(" "),o("td",[o("input",{directives:[{name:"model",rawName:"v-model",value:e.Cantidad,expression:"prod.Cantidad"}],staticClass:"form-control",attrs:{disabled:e.isDisabled,required:"",type:"number"},domProps:{value:e.Cantidad},on:{input:[function(o){o.target.composing||t.$set(e,"Cantidad",o.target.value)},t.emitUpdate]}})]),t._v(" "),o("td",{staticClass:"text-center"},[o("b-button",{attrs:{disabled:e.isDisabled,variant:"danger",size:"sm"},on:{click:function(o){t.quitarProducto(e)}}},[t._v("X")])],1)])}))])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",[this._v("Id")]),this._v(" "),e("th",[this._v("Producto")]),this._v(" "),e("th",[this._v("Cantidad")]),this._v(" "),e("th",{staticClass:"text-center"},[this._v("Quitar")])])])}]};var Ct={mounted:function(){this.getHabitaciones()},data:function(){return{API:v.a.API,show:!1,showPopover:!0,habitaciones:[],selectCliente:{},selectProducto:{},fechaReserva:this.$moment().format("YYYY-MM-DD"),pisos:[1,2,3,4,5]}},methods:{getHabitacionesPiso:function(t){return this.habitaciones.filter(function(e){return e.Piso===t})},guardarProductos:function(){var t=this;this.axios.post(this.API+"preorden/detalle",{IdPreOrden:this.selectProducto.IdPreOrden,IdHabitacion:this.selectProducto.IdProducto,productos:this.$refs.preOrdenProductos.productos}).then(function(e){t.$toasted.success("Guardado correctamente"),t.show=!1})},openCarrito:function(t){this.selectProducto=t,this.$refs.modalCarrito.show()},getHabitaciones:function(){var t=this;this.axios.get(this.API+"habitaciones?sortBy=Gen_Producto.Producto").then(function(e){t.habitaciones=e.data})},getVariant:function(t){return 2==t.EstadoHabitacion?"warning":3==t.EstadoHabitacion?"danger":"success"},reservarHab:function(t){var e=this;this.selectCliente.Cliente||this.$toasted.error("Seleccione un cliente."),this.axios.post(this.API+"habitaciones/reservar",{IdProducto:t.IdProducto,IdCliente:this.selectCliente.IdCliente,FechaReserva:this.fechaReserva}).then(function(o){e.getHabitaciones(),e.limpiarPopover(),e.limpiarDespues(),e.$toasted.success("La Habitación: "+t.Producto+" ha sido reservada"),e.showPopover=!1,e.$nextTick(function(){e.showPopover=!0})})},liberarHab:function(t){var e=this;confirm("¿Está seguro que desea liberar la habitación? Asegurese de haber realizado la venta")&&this.axios.post(this.API+"habitaciones/liberar",{IdProducto:t.IdProducto}).then(function(o){e.getHabitaciones(),e.limpiarPopover(),e.$toasted.success("La Habitación: "+t.Producto+" está ahora disponible"),e.showPopover=!1,e.$nextTick(function(){e.showPopover=!0})})},alquilarHab:function(t){var e=this;this.selectCliente.Cliente||this.$toasted.error("Seleccione un cliente."),confirm("¿Está seguro que desea alquilar la habitación?")&&this.axios.post(this.API+"habitaciones/alquilar",{IdProducto:t.IdProducto,IdCliente:this.selectCliente.IdCliente,cliente:this.selectCliente}).then(function(o){e.getHabitaciones(),e.limpiarPopover(),e.limpiarDespues(),e.$toasted.success("La Habitación: "+t.Producto+" ha sido alquilada"),e.showPopover=!1,e.$nextTick(function(){e.showPopover=!0})})},setCliente:function(t,e){e>=0&&(console.log(this.$refs),console.log(e),console.log("inputCliente2"+e),this.$refs["inputCliente2"+e][0].setValue(t.Cliente)),this.selectCliente=t},limpiarPopover:function(){},limpiarDespues:function(){this.selectCliente={},this.selectProducto={}},formatFecha:function(t){return this.$moment(t,"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD")}},components:{PreOrdenFormDet:o("VU/8")(gt,Pt,!1,function(t){o("nlJO")},"data-v-57c512a8",null).exports,ClientesForm:K}},It={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-container",{staticClass:"bv-example-row"},t._l(t.pisos,function(e,a){return o("div",{key:a,staticClass:"piso"},[t.getHabitacionesPiso(e).length?o("div",[o("br"),t._v(" "),o("b-alert",{staticClass:"text-center",attrs:{show:""}},[o("b",[t._v("PISO "+t._s(e))])]),t._v(" "),o("br")],1):t._e(),t._v(" "),o("b-row",t._l(t.getHabitacionesPiso(e),function(e,r){return o("b-col",{key:r,staticClass:"habitacion",attrs:{md:"3"}},[o("b-card",{staticClass:"text-center",attrs:{"bg-variant":t.getVariant(e)}},[o("h5",[t._v(t._s(e.Producto))]),t._v(" "),o("h5",[t._v("S/. "+t._s(t._f("moneda")(e.PrecioContado)))]),t._v(" "),2==e.EstadoHabitacion?o("ul",{staticClass:"detalle"},[o("li",[o("b",[t._v(t._s(e.Cliente))])]),t._v(" "),o("li",[o("b",[t._v("FECHA: "+t._s(t.formatFecha(e.FechaReserva)))])])]):t._e(),t._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("b-btn",{attrs:{variant:"success",size:"sm"},on:{click:function(o){t.liberarHab(e)}}},[t._v("Liberar")]),t._v(" "),o("b-btn",{attrs:{id:a+"popover-reservar"+r,variant:"warning",size:"sm"}},[t._v("Reservar")]),t._v(" "),t.showPopover?o("b-popover",{attrs:{target:a+"popover-reservar"+r,title:"Reservar Habitación"}},[o("label",[t._v("Seleccione un cliente:")]),t._v(" "),o("autocomplete",{ref:"inputCliente1"+r,refInFor:!0,attrs:{required:"required",url:t.API+"clientes",anchor:"ClienteDniRuc",label:"writer",placeholder:"","on-select":t.setCliente,classes:{input:"form-control"}}}),t._v(" "),o("label",{attrs:{for:"inputLive"}},[t._v("Fecha Reserva:")]),t._v(" "),o("b-form-input",{attrs:{type:"date"},model:{value:t.fechaReserva,callback:function(e){t.fechaReserva=e},expression:"fechaReserva"}}),t._v(" "),o("b-button",{attrs:{variant:"success",size:"sm"},on:{click:function(o){t.reservarHab(e)}}},[t._v("Reservar Habitación")])],1):t._e(),t._v(" "),o("b-btn",{attrs:{id:a+"popover-alquilar"+r,variant:"danger",size:"sm"}},[t._v("Alquilar")]),t._v(" "),t.showPopover?o("b-popover",{attrs:{target:a+"popover-alquilar"+r,title:"Alquilar Habitación"}},[o("label",[t._v("Seleccione un cliente:")]),t._v(" "),o("b-input-group",[o("autocomplete",{ref:"inputCliente2"+r,refInFor:!0,attrs:{required:"required",url:t.API+"clientes",anchor:"ClienteDniRuc",label:"writer",placeholder:"","on-select":t.setCliente,classes:{input:"form-control"}}}),t._v(" "),o("b-input-group-append",[o("clientes-form",{on:{onAddCliente:function(e){t.setCliente(e,r)}}})],1)],1),t._v(" "),o("br"),t._v(" "),o("label",[t._v("Lugar Procedencia:")]),t._v(" "),o("b-input-group",[o("b-form-input",{attrs:{type:"text",placeholder:"Lugar Procedencia"},model:{value:t.selectCliente.LugarProcedencia,callback:function(e){t.$set(t.selectCliente,"LugarProcedencia",e)},expression:"selectCliente.LugarProcedencia"}})],1),t._v(" "),o("br"),t._v(" "),o("label",[t._v("Medio de transporte:")]),t._v(" "),o("b-input-group",[o("b-form-input",{attrs:{type:"text",placeholder:"Medio de transporte"},model:{value:t.selectCliente.MedioTransporte,callback:function(e){t.$set(t.selectCliente,"MedioTransporte",e)},expression:"selectCliente.MedioTransporte"}})],1),t._v(" "),o("br"),t._v(" "),o("label",[t._v("Próximo destino:")]),t._v(" "),o("b-input-group",[o("b-form-input",{attrs:{type:"text",placeholder:"Próximo destino"},model:{value:t.selectCliente.ProximoDestino,callback:function(e){t.$set(t.selectCliente,"ProximoDestino",e)},expression:"selectCliente.ProximoDestino"}})],1),t._v(" "),o("br"),t._v(" "),o("b-button",{attrs:{variant:"success",size:"sm"},on:{click:function(o){t.alquilarHab(e)}}},[t._v("Alquilar Habitación")])],1):t._e(),t._v(" "),e.IdPreOrden?o("b-button",{attrs:{variant:"primary",size:"sm"},on:{click:function(o){t.openCarrito(e)}}},[t._v("+")]):t._e()],1)])],1)}))],1)})),t._v(" "),o("b-form",{on:{submit:function(e){return e.preventDefault(),t.guardarProductos(e)},keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}}},[o("b-modal",{ref:"modalCarrito",attrs:{id:"carrito",title:"Cesta de compras - Habitación "+t.selectProducto.Producto},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("b",[t._v(t._s(t.selectProducto.DniRuc)+" - "+t._s(t.selectProducto.Cliente))]),t._v(" "),o("br"),t._v(" "),o("br"),t._v(" "),t.show?o("pre-orden-form-det",{ref:"preOrdenProductos",attrs:{"id-preorden":t.selectProducto.IdPreOrden,"id-producto":t.selectProducto.IdProducto}}):t._e(),t._v(" "),o("div",{attrs:{slot:"modal-footer"},slot:"modal-footer"},[o("div",{staticStyle:{left:"1rem",position:"absolute"}},[o("b-btn",{attrs:{variant:"info",type:"submit",target:"_blank",href:"/views/V_VentaForm.php?idPreOrden="+t.selectProducto.IdPreOrden+"&idCliente="+t.selectProducto.IdClienteReserva}},[t._v("\n\t\t\t\t\t\tPagar Ahora\n\t\t\t\t\t\t")])],1),t._v(" "),o("b-btn",{attrs:{variant:"success",type:"submit"}},[t._v("\n\t\t\t\t\tGuardar\n\t\t\t\t\t")]),t._v(" "),o("b-btn",{attrs:{variant:"secondary"},on:{click:function(e){t.show=!1}}},[t._v("\n\t\t\t\t\tCerrar\n\t\t\t\t\t")])],1)],1)],1)],1)},staticRenderFns:[]};var kt=o("VU/8")(Ct,It,!1,function(t){o("ytY5")},"data-v-7f8ddcb7",null).exports,At={mounted:function(){var t=this;this.axios.get(this.API+"ventas/count",{params:{idAlmacen:this.almacen.IdAlmacen}}).then(function(e){t.totalRows=e.data.total}),this.getVentasAcumuladas()},data:function(){return{API:v.a.API,vendedor:"",fechaInicio:this.$moment().format("YYYY-MM-DD"),fechaFin:this.$moment().format("YYYY-MM-DD"),declarado:1,filters:{},filter:"",sortBy:"FechaDoc",sortDesc:!1,ventasAcumuladas:0,almacen:{IdAlmacen:1,Almacen:"VENTA"},tipoDoc:{},pageOptions:[5,10,15,50,100],ventaSelect:{},ventaDetalleSelect:[],items:[],showVenta:!1,isBusy:!1,fields:[{key:"idDocVenta",label:"ID",sortable:!0},{key:"FechaDoc",label:"Fecha",sortable:!0},{key:"TipoDoc",label:"Documento",sortable:!0},{key:"Serie",label:"Serie",sortable:!0},{key:"Numero",sortable:!0},{key:"Cliente",sortable:!0},{key:"Anulado",label:"Anulado",sortable:!0},{key:"UsuarioReg",label:"Vendedor",sortable:!0},{key:"Total",sortable:!1,variant:"success",class:"text-center"}],totalRows:50,perPage:10,currentPage:1}},computed:{},methods:{setTipoVenta:function(t){this.tipoDoc=t||{},this.getVentasAcumuladas(),this.$refs.tablaVentas.refresh()},setVendedor:function(t){this.currentPage=1,this.vendedor=t,this.generateFilter("vendedor",t.Usuario)},getVentasAcumuladas:function(){var t=this;this.filters.vendedor?this.axios.get(this.API+"ventas/usuario",{params:{usuario:this.vendedor.Usuario,fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,idTipoDoc:this.tipoDoc.IdTipoDoc||""}}).then(function(e){t.ventasAcumuladas=e.data.total}):this.axios.get(this.API+"ventas/total",{params:{fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,idTipoDoc:this.tipoDoc.IdTipoDoc||""}}).then(function(e){t.ventasAcumuladas=e.data.total})},focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()},setAlmacen:function(t){var e=this;this.almacen=t,this.limpiarFiltros(),Vue.nextTick(function(){return e.$refs.tablaVentas.refresh()})},rowClick:function(t){var e=this;this.ventaSelect=t,this.showKardex=!0,this.axios.get(this.API+"productos/kardex/10?limit=0",{params:{idAlmacen:this.almacen.IdAlmacen,fechaHasta:this.$moment().format("YYYY-MM-DDTH:mm:ss")}}).then(function(t){e.ventaDetalleSelect=t.data})},actualizarTabla:function(){this.$refs.tablaVentas.refresh()},myProvider:function(t){var e=this,o="";this.tipoDoc.IdTipoDoc&&(o="idTipoDoc[]="+this.tipoDoc.IdTipoDoc+"&");var a=this.API+"ventas?"+o+"idAlmacen="+this.almacen.IdAlmacen+"&limit="+t.perPage+"&page="+t.currentPage+"&filter="+(t.filter||"")+"&sortBy="+t.sortBy;return a+="&sortDesc="+(t.sortDesc?1:0),console.log(a),this.axios.get(a).then(function(t){return e.items=t.data,e.items}).catch(function(t){return[]})},limpiarFiltros:function(){this.filters={},this.filter="",this.$refs.inputVendedor.setValue(""),document.location.reload()},generateFilter:function(t,e){this.filters[t]=e;var o="";for(var t in this.filters)o+="&filter["+t+"]="+this.filters[t];this.filter=o,this.getVentasAcumuladas()},exportarProductos:function(){}},components:{ProductoKardex:B}},xt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-container",{staticClass:"bv-example-row"},[o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"10"}},[o("b-row",[o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Almacen:")]),t._v(" "),o("autocomplete",{ref:"inputAlmacen",attrs:{required:"required",url:t.API+"almacenes",anchor:"Almacen",initValue:"VENTA",label:"writer",placeholder:"","on-select":t.setAlmacen,onFocus:t.focusAutocomplete.bind(null,"inputAlmacen"),classes:{input:"form-control"}}})],1),t._v(" "),o("b-form-group",[o("label",[t._v("Fecha Inicio:")]),t._v(" "),o("b-form-input",{attrs:{type:"date",placeholder:""},on:{input:function(e){return t.generateFilter("fechaInicio",e)}},model:{value:t.fechaInicio,callback:function(e){t.fechaInicio=e},expression:"fechaInicio"}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("b-row",[o("b-col",{attrs:{md:"6"}},[o("b-form-group",[o("label",[t._v("Tipo de Venta:")]),t._v(" "),o("autocomplete",{ref:"inputTipoVenta",attrs:{required:"required",url:t.API+"ventas/tipos",anchor:"TipoDoc",label:"writer",placeholder:"","on-select":t.setTipoVenta,onInput:function(e){return!e&&t.setTipoVenta()},onFocus:t.focusAutocomplete.bind(null,"inputTipoVenta"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"6"}},[o("b-form-group",{attrs:{label:"Declarado"}},[o("b-form-radio-group",{attrs:{id:"btnradios1",buttons:"",options:[{text:"SI",value:1},{text:"NO",value:0}],name:"radiosBtnDefault"},on:{input:function(e){return t.generateFilter("declarado",e)}},model:{value:t.declarado,callback:function(e){t.declarado=e},expression:"declarado"}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"12"}},[o("b-form-group",[o("label",[t._v("Fecha Fin:")]),t._v(" "),o("b-form-input",{attrs:{type:"date",placeholder:""},on:{input:function(e){return t.generateFilter("fechaFin",e)}},model:{value:t.fechaFin,callback:function(e){t.fechaFin=e},expression:"fechaFin"}})],1)],1)],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Vendedor:")]),t._v(" "),o("autocomplete",{ref:"inputVendedor",attrs:{required:"required",url:t.API+"usuarios",anchor:"NombreUsuario",label:"writer","on-select":t.setVendedor,onInput:function(e){return!e&&t.generateFilter("vendedor",e)},onFocus:t.focusAutocomplete.bind(null,"inputVendedor"),classes:{input:"form-control"}}})],1),t._v(" "),o("div",{staticClass:"total-ventas"},[t._v("\n                S/ "+t._s(t.ventasAcumuladas||"0.00")+"\n              ")])],1)],1)],1),t._v(" "),o("b-col",{staticClass:"my-1",attrs:{md:"2"}},[o("b-row",[o("b-col",{attrs:{md:"12"}},[o("b-form-group",{attrs:{label:"Limpiar Filtros"}},[o("b-button",{attrs:{disabled:!t.filter},on:{click:t.limpiarFiltros}},[t._v("Limpiar")])],1),t._v(" "),o("b-form-group",{attrs:{label:"Mostrar"}},[o("b-form-select",{attrs:{options:t.pageOptions},on:{input:function(e){t.currentPage=1}},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1),t._v(" "),o("br")],1)],1)],1)],1),t._v(" "),o("b-row",[o("b-col",{attrs:{md:"12"}},[o("b-table",{ref:"tablaVentas",attrs:{small:"",filter:t.filter,"sort-by":t.sortBy,"sort-desc":t.sortDesc,striped:"",hover:"",id:"tabla-ventas",busy:t.isBusy,items:t.myProvider,fields:t.fields,"per-page":t.perPage,"current-page":t.currentPage},on:{"update:sortBy":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"row-clicked":t.rowClick,"update:busy":function(e){t.isBusy=e}},scopedSlots:t._u([{key:"stock",fn:function(e){return[o("div",{class:t.getStock(e.item.IdProducto)>0?"table-success":"table-danger",on:{click:function(t){return t.stopPropagation(),!1}}},[t._v("\n                  "+t._s(t.getStock(e.item.IdProducto))+"\n                ")])]}}])})],1),t._v(" "),o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"6"}},[o("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1),t._v(" "),o("br"),t._v(" "),o("b-row",{staticClass:"text-center",attrs:{"align-h":"center"}},[o("b-col",{attrs:{cols:"4"}},[o("b-button",{attrs:{variant:"success",size:"lg",href:"/api/index.php/reporte/stock?idAlmacen="+t.almacen.IdAlmacen,target:"_blank"}},[t._v("Exportar")])],1)],1),t._v(" "),o("br"),o("br")],1),t._v(" "),o("b-modal",{attrs:{id:"kardex",size:"lg","modal-class":"modal-xl",title:"Kardex de producto"},model:{value:t.showVenta,callback:function(e){t.showVenta=e},expression:"showVenta"}},[o("b-alert",{attrs:{show:"",variant:"warning"}},[t._v("titulo")])],1)],1)},staticRenderFns:[]};var wt=o("VU/8")(At,xt,!1,function(t){o("Z/tc")},null,null).exports,yt={mounted:function(){var t=this;this.axios.get(this.API+"productos/stock?idAlmacen="+this.almacen.IdAlmacen+"&filter[minimo]=1&count=1").then(function(e){t.totalRows=e.data.total})},data:function(){return{API:v.a.API,pageOptions:[5,10,15,50,100],filter:null,sortBy:"Gen_Producto.IdProducto",sortDesc:!1,items:[],isBusy:!1,fields:[{key:"IdProducto",label:"ID",sortable:!0},{key:"CodigoBarra",label:"Codigo",sortable:!0},{key:"Producto",sortable:!0},{key:"ProductoCategoria",label:"Categoría",sortable:!0},{key:"ProductoMarca",label:"Marca",sortable:!0},{key:"ProductoMedicion",label:"Medición",sortable:!0},{key:"stock",label:"Stock",sortable:!0}],totalRows:50,perPage:10,currentPage:1,almacen:{IdAlmacen:1}}},methods:{focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()},setAlmacen:function(t){var e=this;this.almacen=t,Vue.nextTick(function(){return e.$refs.tablaProductos.refresh()})},myProvider:function(t){var e=this,o=this.API+"productos/stock?idAlmacen="+this.almacen.IdAlmacen+"&limit="+t.perPage+"&page="+t.currentPage+"&filter[producto]="+(t.filter||"")+"&filter[minimo]=1&sortBy="+t.sortBy;return o+="&sortDesc="+(t.sortDesc?1:0),this.axios.get(o).then(function(t){return e.items=t.data,e.items}).catch(function(t){return[]})}},components:{ProductoForm:A}},Dt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-container",{staticClass:"bv-example-row"},[o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Buscar:")]),t._v(" "),o("b-input-group",[o("b-form-input",{attrs:{placeholder:"Buscar"},on:{input:function(e){t.currentPage=1}},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),o("b-input-group-append",[o("b-btn",{attrs:{disabled:!t.filter},on:{click:function(e){t.filter=""}}},[t._v("Limpiar")])],1)],1)],1),t._v(" "),o("br")],1),t._v(" "),o("b-col",{attrs:{md:"4"}},[o("b-form-group",[o("label",[t._v("Almacen:")]),t._v(" "),o("autocomplete",{ref:"inputAlmacen",attrs:{required:"required",url:t.API+"almacenes",anchor:"Almacen",initValue:"",label:"writer",placeholder:"","on-select":t.setAlmacen,onFocus:t.focusAutocomplete.bind(null,"inputAlmacen"),classes:{input:"form-control"}}})],1)],1),t._v(" "),o("b-col",{staticClass:"my-1",attrs:{md:"4"}},[o("b-row",[o("b-col",{attrs:{md:"8"}},[o("b-form-group",[o("label",[t._v("Mostrar:")]),t._v(" "),o("b-form-select",{attrs:{options:t.pageOptions},on:{input:function(e){t.currentPage=1}},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1),t._v(" "),o("b-col",{attrs:{md:"4"}})],1)],1),t._v(" "),o("b-table",{ref:"tablaProductos",attrs:{small:"",filter:t.filter,"sort-by":t.sortBy,"sort-desc":t.sortDesc,striped:"",hover:"",id:"my-table",busy:t.isBusy,items:t.myProvider,fields:t.fields,"per-page":t.perPage,"current-page":t.currentPage},on:{"update:sortBy":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},"update:busy":function(e){t.isBusy=e}}}),t._v(" "),o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"6"}},[o("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1)],1),t._v(" "),o("br"),o("br")],1)],1)},staticRenderFns:[]};var St=o("VU/8")(yt,Dt,!1,function(t){o("uuwG")},null,null).exports,Ft={mounted:function(){},watch:{items:function(){var t=this;this.axios.get(this.API+"cierrecaja/count").then(function(e){t.totalRows=e.data.total})}},data:function(){return{API:v.a.API,show:!1,filter:"",items:[],isBusy:!1,fields:["IdCierreCaja","FechaCierre","IdTurno","UsuarioReg","ver"],totalRows:50,perPage:5,currentPage:1}},methods:{selectCierre:function(t){},myProvider:function(t){var e=this;return this.axios.get(this.API+"cierrecaja?limit="+t.perPage+"&page="+t.currentPage+"&filter="+t.filter).then(function(t){return e.items=t.data,e.items}).catch(function(t){return[]})}}},Vt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-button",{attrs:{variant:"outline-success"},on:{click:function(e){t.show=!0}}},[t._v("Ver Cierres")]),t._v(" "),o("b-form",[o("b-modal",{attrs:{id:"modalCierres",title:"Seleccionar Cierre de Caja",size:"lg","header-bg-variant":"dark",headerTextVariant:"light","body-bg-variant":"light","body-text-variant":"dark"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("b-form-input",{attrs:{placeholder:"Buscar"},on:{input:function(e){t.currentPage=1}},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),t.show?o("b-table",{attrs:{id:"my-table",striped:"",hover:"",busy:t.isBusy,filter:t.filter,items:t.myProvider,fields:t.fields,"per-page":t.perPage,"current-page":t.currentPage},on:{"update:busy":function(e){t.isBusy=e},"row-clicked":t.selectCierre},scopedSlots:t._u([{key:"ver",fn:function(e){return[o("b-button",{attrs:{href:"/views/ve_cierreform.php?idCierre="+e.item.IdCierreCaja,variant:"primary",target:"_blank"}},[t._v("Ver")])]}}])}):t._e(),t._v(" "),o("b-row",[o("b-col",{staticClass:"my-1",attrs:{md:"6"}},[o("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)],1),t._v(" "),o("div",{attrs:{slot:"modal-footer"},slot:"modal-footer"},[o("b-btn",{attrs:{size:"sm",variant:"secondary"},on:{click:function(e){t.show=!1}}},[t._v("\n                    Cerrar\n                ")])],1)],1)],1)],1)},staticRenderFns:[]};var $t={mounted:function(){this.loadData(),this.$route.params.id&&this.getCierre(this.$route.params.id)},data:function(){return{API:v.a.API,ventas:[],ingresos:[],salidas:[],turno:null,turnos:[{value:null,text:"Seleccione un Turno"},{value:1,text:"Mañana"},{value:2,text:"Tarde"}],cierre:{},itemsDetalle:[]}},watch:{},computed:{getFechaCierre:function(){},granTotal:function(){return this.totalVentasEfectivo+this.totalVentasVisa+this.totalVentasMastercard+this.totalIngresos-this.totalSalidas},totalSalidas:function(){var t=0;return this.salidas.forEach(function(e){e.Anulado||(t+=e.Importe)}),t},totalIngresos:function(){var t=0;return this.ingresos.forEach(function(e){e.Anulado||(t+=e.Importe)}),t},totalVentasEfectivo:function(){var t=0;return this.ventasEfectivo.forEach(function(e){e.Anulado||(t+=e.Efectivo)}),t},ventasEfectivo:function(){return this.ventas.filter(function(t){return t.Efectivo>0&&!t.EsCredito})},totalVentasVisa:function(){var t=0;return this.ventasVisa.forEach(function(e){e.Anulado||(t+=e.Visa)}),t},ventasVisa:function(){return this.ventas.filter(function(t){return t.Visa>0&&!t.EsCredito})},totalVentasMastercard:function(){var t=0;return this.ventasMastercard.forEach(function(e){e.Anulado||(t+=e.Mastercard)}),t},ventasMastercard:function(){return this.ventas.filter(function(t){return t.Mastercard>0&&!t.EsCredito})},totalVentasCredito:function(){var t=0;return this.ventasCredito.forEach(function(e){e.Anulado||(t+=e.Total)}),t},ventasCredito:function(){return this.ventas.filter(function(t){return t.EsCredito})}},methods:{getDetalles:function(t){return this.itemsDetalle.filter(function(e){return e.IdDocVenta==t})},imprimir:function(){window.print()},loadData:function(){this.getVentas(),this.getIngresos(),this.getSalidas()},cerrarCaja:function(){var t=this;this.turno?confirm("¿Está seguro de cerrar la caja?")&&this.axios.post(this.API+"cierrecaja",{idTurno:this.turno,user:sessionStorage.getItem("User")}).then(function(e){t.loadData(),t.$toasted.show("¡Caja cerrada!"),console.log(e)}):this.$toasted.show("Seleccione un Turno")},estadoVenta:function(t){return t.Anulado?"ANULADO":"APLICADO"},loadDetalles:function(){var t=this;this.axios.get(this.API+"ventas/detalle",{params:{idDocVentas:this.ventas.map(function(t){return t.idDocVenta})}}).then(function(e){t.itemsDetalle=e.data,t.ventas=t.ventas.map(function(e){return e.productos=t.getDetalles(e.idDocVenta),e})}).catch(function(t){console.log(t)})},getVentas:function(){var t=this;this.axios.get(this.API+"cierrecaja/ventas",{params:{idCierre:this.$route.params.id}}).then(function(e){t.ventas=e.data,t.loadDetalles()}).catch(function(t){console.log(t)})},getIngresos:function(){var t=this;this.axios.get(this.API+"cierrecaja/ingresos",{params:{idCierre:this.$route.params.id}}).then(function(e){t.ingresos=e.data}).catch(function(t){console.log(t)})},getSalidas:function(){var t=this;this.axios.get(this.API+"cierrecaja/salidas",{params:{idCierre:this.$route.params.id}}).then(function(e){t.salidas=e.data}).catch(function(t){console.log(t)})},getCierre:function(t){var e=this;this.axios.get(this.API+"cierrecaja",{params:{idCierre:t}}).then(function(t){e.cierre=t.data[0]})}},components:{CierresCaja:o("VU/8")(Ft,Vt,!1,function(t){o("8qVb")},null,null).exports}},Tt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("br"),t._v(" "),o("b-container",{staticClass:"bv-example-row"},[o("div",[o("div",{staticClass:"float-right no-print"},[this.$route.params.id?t._e():o("b-button-group",{attrs:{size:"sm"}},[o("b-form-select",{attrs:{options:t.turnos},model:{value:t.turno,callback:function(e){t.turno=e},expression:"turno"}})],1),t._v(" "),o("b-button-group",{attrs:{size:"sm"}},[this.$route.params.id?t._e():o("b-button",{attrs:{variant:"outline-success"},on:{click:t.cerrarCaja}},[t._v("Cerrar Caja")])],1),t._v(" "),o("b-button-group",{attrs:{size:"sm"}},[o("cierres-caja")],1),t._v(" "),o("b-button-group",{attrs:{size:"sm"}},[o("b-button",{attrs:{variant:"outline-primary"},on:{click:t.imprimir}},[t._v("IMPRIMIR")])],1)],1)]),t._v(" "),o("br",{staticClass:"no-print"}),o("br",{staticClass:"no-print"}),t._v(" "),o("h2",{staticClass:"text-center"},[t._v("Cierre de Caja")]),t._v(" "),t.cierre.FechaCierre?o("h6",{staticClass:"text-center"},[t._v("Fecha: "+t._s(t.cierre.FechaCierre))]):t._e(),t._v(" "),t.cierre.IdTurno?o("h6",{staticClass:"text-center"},[t._v("Turno: "+t._s(1==t.cierre.IdTurno?"MAÑANA":"TARDE"))]):t._e(),t._v(" "),o("b-row",[o("h5",[t._v("Ventas Efectivo")]),o("br"),t._v(" "),o("table",{staticClass:"table b-table table-sm"},[o("thead",[o("tr",[o("th",[t._v("Recibo")]),o("th",[t._v("Fecha")]),o("th",[t._v("Productos")]),o("th",[t._v("Estado")]),o("th",[t._v("Pagado")])])]),t._v(" "),o("tbody",t._l(t.ventasEfectivo,function(e,a){return o("tr",{key:a,class:{anulado:e.Anulado}},[o("td",[t._v(t._s(e.TipoDoc+"-"+e.Serie+"-"+e.Numero))]),t._v(" "),o("td",[t._v(t._s(e.FechaDoc))]),t._v(" "),o("td",[o("table",{staticClass:"tabla-detalle"},[o("thead",[o("tr",[o("th",[t._v("Codigo")]),t._v(" "),o("th",[t._v("Producto")]),t._v(" "),o("th",[t._v("Cantidad")]),t._v(" "),o("th",[t._v("Precio")]),t._v(" "),o("th",[t._v("Descuento")]),t._v(" "),e.TieneIgv?o("th",[t._v("Subtotal")]):t._e(),t._v(" "),e.TieneIgv?o("th",[t._v("IGV")]):t._e(),t._v(" "),o("th",[t._v("Total")])])]),t._v(" "),o("tbody",t._l(e.productos,function(a,r){return o("tr",{key:r},[o("td",[t._v(t._s(a.CodigoBarra))]),t._v(" "),o("td",{staticClass:"detalle-producto"},[t._v(t._s(a.Producto))]),t._v(" "),o("td",[t._v(t._s(a.Cantidad))]),t._v(" "),o("td",[t._v(t._s(a.Precio))]),t._v(" "),o("td",[t._v(t._s(a.Descuento))]),t._v(" "),e.TieneIgv?o("td",[t._v("\n                      "+t._s(t._f("redondear")(a.Subtotal-.18*a.Subtotal))+"\n                    ")]):t._e(),t._v(" "),e.TieneIgv?o("td",[t._v("\n                      "+t._s(t._f("redondear")(.18*a.Subtotal))+"\n                    ")]):t._e(),t._v(" "),o("td",[t._v(t._s(t._f("redondear")(a.Subtotal)))])])}))]),t._v(" "),o("div",[o("i",[o("b",[t._v("Cliente:")]),t._v(" "+t._s(e.Cliente))])])]),t._v(" "),o("td",[t._v(t._s(t.estadoVenta(e)))]),t._v(" "),o("td",[t._v("S/. "+t._s(t._f("redondear")(e.Efectivo)))])])})),t._v(" "),o("tfoot",[o("tr",[o("td",{attrs:{colspan:"3"}}),t._v(" "),o("td",{staticClass:"total"},[o("b",[t._v("Total Efectivo")])]),t._v(" "),o("td",{staticClass:"total"},[o("b",[t._v("S/. "+t._s(t._f("redondear")(t.totalVentasEfectivo)))])])])])])]),t._v(" "),o("b-row",[o("h5",[t._v("Ventas Visa")]),o("br"),t._v(" "),o("table",{staticClass:"table b-table table-sm"},[o("thead",[o("tr",[o("th",[t._v("Recibo")]),o("th",[t._v("Fecha")]),o("th",[t._v("Productos")]),o("th",[t._v("Detalle")]),o("th",[t._v("Estado")]),o("th",[t._v("Pagado")])])]),t._v(" "),o("tbody",t._l(t.ventasVisa,function(e,a){return o("tr",{key:a,class:{anulado:e.Anulado}},[o("td",[t._v(t._s(e.TipoDoc+"-"+e.Serie+"-"+e.Numero))]),t._v(" "),o("td",[t._v(t._s(e.FechaDoc))]),t._v(" "),o("td",[o("table",{staticClass:"tabla-detalle"},[o("thead",[o("tr",[o("th",[t._v("Codigo")]),t._v(" "),o("th",[t._v("Producto")]),t._v(" "),o("th",[t._v("Cantidad")]),t._v(" "),o("th",[t._v("Precio")]),t._v(" "),o("th",[t._v("Descuento")]),t._v(" "),e.TieneIgv?o("th",[t._v("Subtotal")]):t._e(),t._v(" "),e.TieneIgv?o("th",[t._v("IGV")]):t._e(),t._v(" "),o("th",[t._v("Total")])])]),t._v(" "),o("tbody",t._l(e.productos,function(a,r){return o("tr",{key:r},[o("td",[t._v(t._s(a.CodigoBarra))]),t._v(" "),o("td",{staticClass:"detalle-producto"},[t._v(t._s(a.Producto))]),t._v(" "),o("td",[t._v(t._s(a.Cantidad))]),t._v(" "),o("td",[t._v(t._s(a.Precio))]),t._v(" "),o("td",[t._v(t._s(a.Descuento))]),t._v(" "),e.TieneIgv?o("td",[t._v("\n                      "+t._s(t._f("redondear")(a.Subtotal-.18*a.Subtotal))+"\n                    ")]):t._e(),t._v(" "),e.TieneIgv?o("td",[t._v("\n                      "+t._s(t._f("redondear")(.18*a.Subtotal))+"\n                    ")]):t._e(),t._v(" "),o("td",[t._v(t._s(t._f("redondear")(a.Subtotal)))])])}))]),t._v(" "),o("div",[o("i",[o("b",[t._v("Cliente:")]),t._v(" "+t._s(e.Cliente))])])]),t._v(" "),o("td",[t._v(t._s(e.VisaDesc))]),t._v(" "),o("td",[t._v(t._s(t.estadoVenta(e)))]),t._v(" "),o("td",[t._v("S/. "+t._s(e.Visa))])])})),t._v(" "),o("tfoot",[o("tr",[o("td",{attrs:{colspan:"4"}}),t._v(" "),o("td",{staticClass:"total"},[o("b",[t._v("Total Visa")])]),t._v(" "),o("td",{staticClass:"total"},[o("b",[t._v("S/. "+t._s(t._f("redondear")(t.totalVentasVisa)))])])])])])]),t._v(" "),o("b-row",[o("h5",[t._v("Ventas Mastercard")]),o("br"),t._v(" "),o("table",{staticClass:"table b-table table-sm"},[o("thead",[o("tr",[o("th",[t._v("Recibo")]),o("th",[t._v("Fecha")]),o("th",[t._v("Productos")]),o("th",[t._v("Detalle")]),o("th",[t._v("Estado")]),o("th",[t._v("Pagado")])])]),t._v(" "),o("tbody",t._l(t.ventasMastercard,function(e,a){return o("tr",{key:a,class:{anulado:e.Anulado}},[o("td",[t._v(t._s(e.TipoDoc+"-"+e.Serie+"-"+e.Numero))]),t._v(" "),o("td",[t._v(t._s(e.FechaDoc))]),t._v(" "),o("td",[o("table",{staticClass:"tabla-detalle"},[o("thead",[o("tr",[o("th",[t._v("Codigo")]),t._v(" "),o("th",[t._v("Producto")]),t._v(" "),o("th",[t._v("Cantidad")]),t._v(" "),o("th",[t._v("Precio")]),t._v(" "),o("th",[t._v("Descuento")]),t._v(" "),e.TieneIgv?o("th",[t._v("Subtotal")]):t._e(),t._v(" "),e.TieneIgv?o("th",[t._v("IGV")]):t._e(),t._v(" "),o("th",[t._v("Total")])])]),t._v(" "),o("tbody",t._l(e.productos,function(a,r){return o("tr",{key:r},[o("td",[t._v(t._s(a.CodigoBarra))]),t._v(" "),o("td",{staticClass:"detalle-producto"},[t._v(t._s(a.Producto))]),t._v(" "),o("td",[t._v(t._s(a.Cantidad))]),t._v(" "),o("td",[t._v(t._s(a.Precio))]),t._v(" "),o("td",[t._v(t._s(a.Descuento))]),t._v(" "),e.TieneIgv?o("td",[t._v("\n                      "+t._s(t._f("redondear")(a.Subtotal-.18*a.Subtotal))+"\n                    ")]):t._e(),t._v(" "),e.TieneIgv?o("td",[t._v("\n                      "+t._s(t._f("redondear")(.18*a.Subtotal))+"\n                    ")]):t._e(),t._v(" "),o("td",[t._v(t._s(t._f("redondear")(a.Subtotal)))])])}))]),t._v(" "),o("div",[o("i",[o("b",[t._v("Cliente:")]),t._v(" "+t._s(e.Cliente))])])]),t._v(" "),o("td",[t._v(t._s(e.MastercardDesc))]),t._v(" "),o("td",[t._v(t._s(t.estadoVenta(e)))]),t._v(" "),o("td",[t._v("S/. "+t._s(e.Mastercard))])])})),t._v(" "),o("tfoot",[o("tr",[o("td",{attrs:{colspan:"4"}}),t._v(" "),o("td",{staticClass:"total"},[o("b",[t._v("Total Mastercard")])]),t._v(" "),o("td",{staticClass:"total"},[o("b",[t._v("S/. "+t._s(t.totalVentasMastercard))])])])])])]),t._v(" "),o("b-row",{staticClass:"credito"},[o("h5",[t._v("Ventas a Credito")]),o("br"),t._v(" "),o("table",{staticClass:"table b-table table-sm"},[o("thead",[o("tr",[o("th",[t._v("Recibo")]),o("th",[t._v("Fecha")]),o("th",[t._v("Productos")]),o("th",[t._v("Estado")]),o("th",[t._v("Pagado")])])]),t._v(" "),o("tbody",t._l(t.ventasCredito,function(e,a){return o("tr",{key:a,class:{anulado:e.Anulado}},[o("td",[t._v(t._s(e.TipoDoc+"-"+e.Serie+"-"+e.Numero))]),t._v(" "),o("td",[t._v(t._s(e.FechaDoc))]),t._v(" "),o("td",[o("table",{staticClass:"tabla-detalle"},[o("thead",[o("tr",[o("th",[t._v("Codigo")]),t._v(" "),o("th",[t._v("Producto")]),t._v(" "),o("th",[t._v("Cantidad")]),t._v(" "),o("th",[t._v("Precio")]),t._v(" "),o("th",[t._v("Descuento")]),t._v(" "),e.TieneIgv?o("th",[t._v("Subtotal")]):t._e(),t._v(" "),e.TieneIgv?o("th",[t._v("IGV")]):t._e(),t._v(" "),o("th",[t._v("Total")])])]),t._v(" "),o("tbody",t._l(e.productos,function(a,r){return o("tr",{key:r},[o("td",[t._v(t._s(a.CodigoBarra))]),t._v(" "),o("td",{staticClass:"detalle-producto"},[t._v(t._s(a.Producto))]),t._v(" "),o("td",[t._v(t._s(a.Cantidad))]),t._v(" "),o("td",[t._v(t._s(a.Precio))]),t._v(" "),o("td",[t._v(t._s(a.Descuento))]),t._v(" "),e.TieneIgv?o("td",[t._v("\n                      "+t._s(t._f("redondear")(a.Subtotal-.18*a.Subtotal))+"\n                    ")]):t._e(),t._v(" "),e.TieneIgv?o("td",[t._v("\n                      "+t._s(t._f("redondear")(.18*a.Subtotal))+"\n                    ")]):t._e(),t._v(" "),o("td",[t._v(t._s(t._f("redondear")(a.Subtotal)))])])}))]),t._v(" "),o("div",[o("i",[o("b",[t._v("Cliente:")]),t._v(" "+t._s(e.Cliente))])])]),t._v(" "),o("td",[t._v(t._s(t.estadoVenta(e)))]),t._v(" "),o("td",[t._v("S/. "+t._s(t._f("redondear")(e.Total)))])])})),t._v(" "),o("tfoot",[o("tr",[o("td",{attrs:{colspan:"3"}}),t._v(" "),o("td",[o("b",[t._v("Total Credito")])]),t._v(" "),o("td",[o("b",[t._v("S/. "+t._s(t._f("moneda")(t.totalVentasCredito)))])])])])])]),t._v(" "),o("b-row",[t.totalIngresos?o("b-col",[o("h5",[t._v("Ingresos")]),o("br"),t._v(" "),o("table",{staticClass:"table b-table table-sm"},[o("thead",[o("tr",[o("th",[t._v("ID")]),o("th",[t._v("Fecha")]),o("th",[t._v("Detalle")]),o("th",[t._v("Ingreso")])])]),t._v(" "),o("tbody",t._l(t.ingresos,function(e,a){return o("tr",{key:a},[o("td",[t._v(t._s(e.IdCajaBanco))]),t._v(" "),o("td",[t._v(t._s(e.FechaDoc))]),t._v(" "),o("td",[t._v(t._s(e.Concepto))]),t._v(" "),o("td",[t._v("S/. "+t._s(e.Importe))])])})),t._v(" "),o("tfoot",[o("tr",[o("td",{attrs:{colspan:"2"}}),t._v(" "),o("td",{staticClass:"total"},[o("b",[t._v("Total Ingresos")])]),t._v(" "),o("td",{staticClass:"total"},[o("b",[t._v("S/. "+t._s(t.totalIngresos))])])])])])]):t._e(),t._v(" "),t.totalSalidas?o("b-col",[o("h5",[t._v("Salidas")]),o("br"),t._v(" "),o("table",{staticClass:"table b-table table-sm"},[o("thead",[o("tr",[o("th",[t._v("ID")]),o("th",[t._v("Fecha")]),o("th",[t._v("Detalle")]),o("th",[t._v("Salida")])])]),t._v(" "),o("tbody",t._l(t.salidas,function(e,a){return o("tr",{key:a},[o("td",[t._v(t._s(e.IdCajaBanco))]),t._v(" "),o("td",[t._v(t._s(e.FechaDoc))]),t._v(" "),o("td",[t._v(t._s(e.Concepto))]),t._v(" "),o("td",[t._v("S/. "+t._s(e.Importe))])])})),t._v(" "),o("tfoot",[o("tr",[o("td",{attrs:{colspan:"2"}}),t._v(" "),o("td",{staticClass:"total-salida"},[o("b",[t._v("Total Salidas")])]),t._v(" "),o("td",{staticClass:"total-salida"},[o("b",[t._v("S/. "+t._s(t.totalSalidas))])])])])])]):t._e()],1),t._v(" "),o("br"),t._v(" "),o("b-alert",{staticClass:"text-center",attrs:{variant:"success",show:""}},[o("b",[t._v("GRAN TOTAL: S/. "+t._s(t._f("moneda")(t.granTotal)))])])],1)],1)},staticRenderFns:[]};var Mt=o("VU/8")($t,Tt,!1,function(t){o("1s1a")},"data-v-71d07ade",null).exports,Et={mounted:function(){this.getRegistroHuespedes()},data:function(){return{API:v.a.API,huespedes:[],fechaRegistroInicio:this.$moment().format("YYYY-MM-DD"),fechaRegistroFin:this.$moment().format("YYYY-MM-DD"),almacen:{IdAlmacen:1}}},methods:{focusAutocomplete:function(t){this.$refs[t].handleDoubleClick()},setAlmacen:function(t){var e=this;this.almacen=t,Vue.nextTick(function(){return e.$refs.tablaProductos.refresh()})},getRegistroHuespedes:function(){var t=this;this.axios.get(this.API+"reporte/habitaciones?idAlmacen="+this.almacen.IdAlmacen+"&fechaInicio="+this.fechaRegistroInicio+"&fechaFin="+this.fechaRegistroFin).then(function(e){t.huespedes=e.data})}},components:{}},Rt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-container",{staticClass:"container-huespedes"},[o("b-row",{staticClass:"no-print"},[o("b-col",{staticClass:"my-1",attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Fecha Registro Inicio:")]),t._v(" "),o("b-input-group",[o("b-form-input",{attrs:{type:"date"},model:{value:t.fechaRegistroInicio,callback:function(e){t.fechaRegistroInicio=e},expression:"fechaRegistroInicio"}})],1)],1)],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Fecha Registro Fin:")]),t._v(" "),o("b-input-group",[o("b-form-input",{attrs:{type:"date"},model:{value:t.fechaRegistroFin,callback:function(e){t.fechaRegistroFin=e},expression:"fechaRegistroFin"}})],1)],1)],1),t._v(" "),o("b-col",{attrs:{md:"3"}},[o("b-form-group",[o("label",[t._v("Buscar:")]),t._v(" "),o("b-input-group",[o("b-btn",{attrs:{variant:"success"},on:{click:t.getRegistroHuespedes}},[t._v("Buscar")])],1)],1)],1)],1),t._v(" "),o("div",{staticClass:"registro"},[o("h1",{staticClass:"text-center"},[t._v("Registro de Huéspedes")]),t._v(" "),o("b-row",[o("table",{staticClass:"table b-table table-striped table-hover"},[o("thead",[o("tr",[o("th",[t._v("Habitación")]),t._v(" "),o("th",[t._v("Apellidos y Nombres")]),t._v(" "),o("th",[t._v("Sexo")]),t._v(" "),o("th",[t._v("Ocupacion")]),t._v(" "),o("th",[t._v("F. Nacimiento")]),t._v(" "),o("th",[t._v("Nacionalidad")]),t._v(" "),o("th",[t._v("Documento de Identidad")]),t._v(" "),o("th",[t._v("Direccion")]),t._v(" "),o("th",[t._v("Fecha de Ingreso")]),t._v(" "),o("th",[t._v("Lugar de Procedencia")]),t._v(" "),o("th",[t._v("Medio de Transporte")]),t._v(" "),o("th",[t._v("Próximo Destino")]),t._v(" "),o("th",[t._v("Fecha de salida")]),t._v(" "),o("th",[t._v("Tipo")]),t._v(" "),o("th",[t._v("Tarifa")])])]),t._v(" "),o("tbody",t._l(t.huespedes,function(e,a){return o("tr",{key:a},[o("td",[t._v(t._s(e.Producto))]),t._v(" "),o("td",[t._v(t._s(e.Cliente))]),t._v(" "),o("td",[t._v(t._s(e.Sexo))]),t._v(" "),o("td",[t._v(t._s(e.Ocupacion))]),t._v(" "),o("td",[t._v(t._s(e.FechaNacimiento))]),t._v(" "),o("td",[t._v(t._s(e.Nacionalidad))]),t._v(" "),o("td",[t._v(t._s(e.DniRuc))]),t._v(" "),o("td",[t._v(t._s(e.Direccion))]),t._v(" "),o("td",[t._v(t._s(e.FechaAlquilerInicio))]),t._v(" "),o("td",[t._v(t._s(e.LugarProcedencia))]),t._v(" "),o("td",[t._v(t._s(e.MedioTransporte))]),t._v(" "),o("td",[t._v(t._s(e.ProximoDestino))]),t._v(" "),o("td",[t._v(t._s(e.FechaAlquilerFin))]),t._v(" "),o("td",[t._v(t._s(e.ProductoMarca))]),t._v(" "),o("td",[t._v(t._s(e.Tarifa))])])}))])])],1),t._v(" "),o("br"),o("br")],1)],1)},staticRenderFns:[]};var jt=o("VU/8")(Et,Rt,!1,function(t){o("yZ4T")},"data-v-bef6cf94",null).exports;a.a.use(i.a);var Nt=new i.a({routes:[{path:"/",name:"Movimiento",component:T},{path:"/productos",name:"Productos",component:R},{path:"/habitaciones",name:"Habitaciones",component:kt},{path:"/almacen",name:"Almacen",component:U},{path:"/ventas",name:"Ventas",component:at},{path:"/reportes/ventas",name:"ReporteVentas",component:wt},{path:"/reportes/cierrecaja",name:"CierreCaja",component:Mt},{path:"/reportes/cierrecaja/:id",name:"CierreCajaId",component:Mt},{path:"/reportes/stockminimo",name:"StockMinimo",component:St},{path:"/reportes/huespedes",name:"RegistroHuespedes",component:jt},{path:"/facturacion",name:"VentasFacturacion",component:_t}]}),Ot=o("d7EF"),Bt=o.n(Ot),qt=o("mtWM"),zt=o.n(qt),Ut={state:{productos:[],productosFiltrados:[],totalCart:0},mutations:{AGREGAR_PRODUCTO:function(t,e){var o=t.productos;if(e.setSuma){var a=o.findIndex(function(t){return t.IdProducto==e.IdProducto});a<0?o.push(e):o[a].cantidad+=1}else o.find(function(t){return t.IdProducto===e.IdProducto})||o.push(e)},ELIMINAR_PRODUCTO:function(t,e){t.productos.splice(e,1)},LLENAR_PRODUCTOS_FILTRADOS:function(t,e){t.productosFiltrados=e},LIMPIAR_CART:function(t){t.productos=[]},APLICAR_DESCUENTO:function(t,e){var o=0;t.productos.forEach(function(t,e){o+=parseFloat(t.cantidad)}),t.productos=t.productos.map(function(t){return t.descuento=(e/o*t.cantidad).toFixed(2),t})},ACTUALIZAR_TOTAL:function(t,e){t.totalCart=e},OBTENER_STOCK:function(t,e){t.productos=t.productos.map(function(t){var o=e.findIndex(function(e){return e.IdProducto==t.IdProducto});return t.stock=e[o]&&e[o].stock,t})}},actions:{agregarProducto:function(t,e){var o=t.commit,a=Bt()(e,4),r=a[0],n=a[1],i=a[2],s=a[3],c=!1,l=!1,u=!1;if(i&&(c=i.setPrecio,l=i.cantidad,u=i.setSuma),"object"===(void 0===r?"undefined":H()(r)))o("AGREGAR_PRODUCTO",r),n&&n(r);else{var d={};s&&(d={codigoBarra:r}),zt.a.get(p.API+"productos/id/"+r,{params:d}).then(function(t){if(t.data){var e=t.data;c?(e.cantidad=1,e.precio=e.PrecioContado||0):(e.cantidad=0,e.precio=0),l&&(e.cantidad=l),u&&(e.setSuma=!0),e.descuento=0,e.nuevoPrecioContado=0,o("AGREGAR_PRODUCTO",e),n&&n(e)}else n&&n(!1)})}},eliminarProducto:function(t,e){(0,t.commit)("ELIMINAR_PRODUCTO",e)},buscarProductos:function(t,e){var o=t.commit;zt.a.get(p.API+"productos?limit=10&q="+e).then(function(t){o("LLENAR_PRODUCTOS_FILTRADOS",t.data)})},limpiarCarrito:function(t){(0,t.commit)("LIMPIAR_CART")},aplicarDescuentoGeneral:function(t,e){(0,t.commit)("APLICAR_DESCUENTO",e)},actualizarTotalCart:function(t,e){(0,t.commit)("ACTUALIZAR_TOTAL",e)},obtenerStock:function(t,e){var o=t.commit,a=t.state;zt.a.get(p.API+"productos/stock",{params:{idProductos:a.productos.map(function(t){return t.IdProducto}),idAlmacen:e.IdAlmacen}}).then(function(t){o("OBTENER_STOCK",t.data)}).catch(function(t){console.log(t)})}}},Yt={buscarProveedores:function(t,e){var o=t.commit;zt.a.get(p.API+"proveedores?limit=10&q="+e).then(function(t){o("LLENAR_PROVEEDORES_FILTRADOS",t.data)})},buscarAlmacenes:function(t,e){var o=t.commit;zt.a.get(p.API+"almacenes?q="+e).then(function(t){o("LLENAR_ALMACENES_FILTRADOS",t.data)})}};a.a.use(d.a);var Ht=new d.a.Store({state:{proveedoresFiltrados:[],almacenesFiltrados:[]},actions:Yt,mutations:{LLENAR_PROVEEDORES_FILTRADOS:function(t,e){t.proveedoresFiltrados=e},LLENAR_ALMACENES_FILTRADOS:function(t,e){t.almacenesFiltrados=e}},modules:{cart:Ut}}),Lt=o("e6fC"),Gt=o("9XJu"),Kt=o.n(Gt),Xt=o("Rf8U"),Zt=o.n(Xt),Jt=o("IZMb"),Qt=o.n(Jt),Wt=o("mjDs"),te=o.n(Wt),ee=o("+9Dj");o("Jmt5"),o("9M+g"),o("imi0"),o("ux0l"),Object(ee.detect)();a.a.prototype.$browser=Object(ee.detect)(),a.a.config.productionTip=!1,a.a.use(Zt.a,zt.a),a.a.use(Qt.a,{theme:"bubble",position:"top-center",duration:3e3}),a.a.use(Lt.a),a.a.use(te.a),a.a.component("autocomplete",Kt.a),a.a.component("editable",{template:'<div contenteditable="true" @input="update"></div>',props:["content"],mounted:function(){this.$el.innerText=this.content},methods:{update:function(t){this.$emit("update",t.target.innerText)}}}),a.a.filter("redondear",function(t,e){return parseFloat(t||0).toFixed(e||2)}),a.a.filter("redondeoMayor",function(t){return Math.ceil(t||0)}),a.a.filter("redondeoMenor",function(t){return Math.floor(t||0)}),a.a.filter("moneda",function(t){return parseFloat(t||0).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}),window.Vue=a.a,new a.a({el:"#app",router:Nt,store:Ht,components:{App:n},template:"<App/>"})},OmDo:function(t,e){},ROxG:function(t,e){},Sxdx:function(t,e){},SyeH:function(t,e){},Tfc3:function(t,e){},UdTa:function(t,e,o){t.exports={API:"/api/index.php/"}},XZXq:function(t,e){},"Z/tc":function(t,e){},hJma:function(t,e){},imi0:function(t,e){},nlJO:function(t,e){},o8nZ:function(t,e){},shh4:function(t,e){},tI9C:function(t,e){},uslO:function(t,e,o){var a={"./af":"3CJN","./af.js":"3CJN","./ar":"3MVc","./ar-dz":"tkWw","./ar-dz.js":"tkWw","./ar-kw":"j8cJ","./ar-kw.js":"j8cJ","./ar-ly":"wPpW","./ar-ly.js":"wPpW","./ar-ma":"dURR","./ar-ma.js":"dURR","./ar-sa":"7OnE","./ar-sa.js":"7OnE","./ar-tn":"BEem","./ar-tn.js":"BEem","./ar.js":"3MVc","./az":"eHwN","./az.js":"eHwN","./be":"3hfc","./be.js":"3hfc","./bg":"lOED","./bg.js":"lOED","./bm":"hng5","./bm.js":"hng5","./bn":"aM0x","./bn.js":"aM0x","./bo":"w2Hs","./bo.js":"w2Hs","./br":"OSsP","./br.js":"OSsP","./bs":"aqvp","./bs.js":"aqvp","./ca":"wIgY","./ca.js":"wIgY","./cs":"ssxj","./cs.js":"ssxj","./cv":"N3vo","./cv.js":"N3vo","./cy":"ZFGz","./cy.js":"ZFGz","./da":"YBA/","./da.js":"YBA/","./de":"DOkx","./de-at":"8v14","./de-at.js":"8v14","./de-ch":"Frex","./de-ch.js":"Frex","./de.js":"DOkx","./dv":"rIuo","./dv.js":"rIuo","./el":"CFqe","./el.js":"CFqe","./en-au":"Sjoy","./en-au.js":"Sjoy","./en-ca":"Tqun","./en-ca.js":"Tqun","./en-gb":"hPuz","./en-gb.js":"hPuz","./en-ie":"ALEw","./en-ie.js":"ALEw","./en-il":"QZk1","./en-il.js":"QZk1","./en-nz":"dyB6","./en-nz.js":"dyB6","./eo":"Nd3h","./eo.js":"Nd3h","./es":"LT9G","./es-do":"7MHZ","./es-do.js":"7MHZ","./es-us":"INcR","./es-us.js":"INcR","./es.js":"LT9G","./et":"XlWM","./et.js":"XlWM","./eu":"sqLM","./eu.js":"sqLM","./fa":"2pmY","./fa.js":"2pmY","./fi":"nS2h","./fi.js":"nS2h","./fo":"OVPi","./fo.js":"OVPi","./fr":"tzHd","./fr-ca":"bXQP","./fr-ca.js":"bXQP","./fr-ch":"VK9h","./fr-ch.js":"VK9h","./fr.js":"tzHd","./fy":"g7KF","./fy.js":"g7KF","./gd":"nLOz","./gd.js":"nLOz","./gl":"FuaP","./gl.js":"FuaP","./gom-latn":"+27R","./gom-latn.js":"+27R","./gu":"rtsW","./gu.js":"rtsW","./he":"Nzt2","./he.js":"Nzt2","./hi":"ETHv","./hi.js":"ETHv","./hr":"V4qH","./hr.js":"V4qH","./hu":"xne+","./hu.js":"xne+","./hy-am":"GrS7","./hy-am.js":"GrS7","./id":"yRTJ","./id.js":"yRTJ","./is":"upln","./is.js":"upln","./it":"FKXc","./it.js":"FKXc","./ja":"ORgI","./ja.js":"ORgI","./jv":"JwiF","./jv.js":"JwiF","./ka":"RnJI","./ka.js":"RnJI","./kk":"j+vx","./kk.js":"j+vx","./km":"5j66","./km.js":"5j66","./kn":"gEQe","./kn.js":"gEQe","./ko":"eBB/","./ko.js":"eBB/","./ky":"6cf8","./ky.js":"6cf8","./lb":"z3hR","./lb.js":"z3hR","./lo":"nE8X","./lo.js":"nE8X","./lt":"/6P1","./lt.js":"/6P1","./lv":"jxEH","./lv.js":"jxEH","./me":"svD2","./me.js":"svD2","./mi":"gEU3","./mi.js":"gEU3","./mk":"Ab7C","./mk.js":"Ab7C","./ml":"oo1B","./ml.js":"oo1B","./mn":"CqHt","./mn.js":"CqHt","./mr":"5vPg","./mr.js":"5vPg","./ms":"ooba","./ms-my":"G++c","./ms-my.js":"G++c","./ms.js":"ooba","./mt":"oCzW","./mt.js":"oCzW","./my":"F+2e","./my.js":"F+2e","./nb":"FlzV","./nb.js":"FlzV","./ne":"/mhn","./ne.js":"/mhn","./nl":"3K28","./nl-be":"Bp2f","./nl-be.js":"Bp2f","./nl.js":"3K28","./nn":"C7av","./nn.js":"C7av","./pa-in":"pfs9","./pa-in.js":"pfs9","./pl":"7LV+","./pl.js":"7LV+","./pt":"ZoSI","./pt-br":"AoDM","./pt-br.js":"AoDM","./pt.js":"ZoSI","./ro":"wT5f","./ro.js":"wT5f","./ru":"ulq9","./ru.js":"ulq9","./sd":"fW1y","./sd.js":"fW1y","./se":"5Omq","./se.js":"5Omq","./si":"Lgqo","./si.js":"Lgqo","./sk":"OUMt","./sk.js":"OUMt","./sl":"2s1U","./sl.js":"2s1U","./sq":"V0td","./sq.js":"V0td","./sr":"f4W3","./sr-cyrl":"c1x4","./sr-cyrl.js":"c1x4","./sr.js":"f4W3","./ss":"7Q8x","./ss.js":"7Q8x","./sv":"Fpqq","./sv.js":"Fpqq","./sw":"DSXN","./sw.js":"DSXN","./ta":"+7/x","./ta.js":"+7/x","./te":"Nlnz","./te.js":"Nlnz","./tet":"gUgh","./tet.js":"gUgh","./tg":"5SNd","./tg.js":"5SNd","./th":"XzD+","./th.js":"XzD+","./tl-ph":"3LKG","./tl-ph.js":"3LKG","./tlh":"m7yE","./tlh.js":"m7yE","./tr":"k+5o","./tr.js":"k+5o","./tzl":"iNtv","./tzl.js":"iNtv","./tzm":"FRPF","./tzm-latn":"krPU","./tzm-latn.js":"krPU","./tzm.js":"FRPF","./ug-cn":"To0v","./ug-cn.js":"To0v","./uk":"ntHu","./uk.js":"ntHu","./ur":"uSe8","./ur.js":"uSe8","./uz":"XU1s","./uz-latn":"/bsm","./uz-latn.js":"/bsm","./uz.js":"XU1s","./vi":"0X8Q","./vi.js":"0X8Q","./x-pseudo":"e/KL","./x-pseudo.js":"e/KL","./yo":"YXlc","./yo.js":"YXlc","./zh-cn":"Vz2w","./zh-cn.js":"Vz2w","./zh-hk":"ZUyn","./zh-hk.js":"ZUyn","./zh-tw":"BbgG","./zh-tw.js":"BbgG"};function r(t){return o(n(t))}function n(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}r.keys=function(){return Object.keys(a)},r.resolve=n,t.exports=r,r.id="uslO"},uuwG:function(t,e){},ux0l:function(t,e){},vEAQ:function(t,e){},yZ4T:function(t,e){},ytY5:function(t,e){},zCoZ:function(t,e){},zj2Q:function(t,e){},zuH2:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.053a07f083dc52c2918e.js.map